<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3.5 Normal and Estimating Means | Statistical Inference</title>
  <meta name="description" content="Notes cobbled together from books, online classes, etc. to be used as quick reference for common work projects." />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="3.5 Normal and Estimating Means | Statistical Inference" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Notes cobbled together from books, online classes, etc. to be used as quick reference for common work projects." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3.5 Normal and Estimating Means | Statistical Inference" />
  
  <meta name="twitter:description" content="Notes cobbled together from books, online classes, etc. to be used as quick reference for common work projects." />
  

<meta name="author" content="Michael Foley" />


<meta name="date" content="2023-11-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="gamma-poisson-and-estimating-counts.html"/>
<link rel="next" href="beta-binomial-and-estimating-proportions.html"/>
<script src="assets/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="assets/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="assets/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="assets/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="assets/tabwid-1.1.3/tabwid.css" rel="stylesheet" />
<script src="assets/tabwid-1.1.3/tabwid.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="frequentist-statistics.html"><a href="frequentist-statistics.html"><i class="fa fa-check"></i><b>1</b> Frequentist Statistics</a>
<ul>
<li class="chapter" data-level="1.1" data-path="central-tendancy-and-dispersion.html"><a href="central-tendancy-and-dispersion.html"><i class="fa fa-check"></i><b>1.1</b> Central Tendancy and Dispersion</a></li>
<li class="chapter" data-level="1.2" data-path="hypothesis-testing.html"><a href="hypothesis-testing.html"><i class="fa fa-check"></i><b>1.2</b> Hypothesis Testing</a>
<ul>
<li class="chapter" data-level="" data-path="hypothesis-testing.html"><a href="hypothesis-testing.html#type-i-and-ii-errors"><i class="fa fa-check"></i>Type I and II Errors</a></li>
<li class="chapter" data-level="" data-path="hypothesis-testing.html"><a href="hypothesis-testing.html#statistical-power"><i class="fa fa-check"></i>Statistical Power</a></li>
<li class="chapter" data-level="" data-path="hypothesis-testing.html"><a href="hypothesis-testing.html#what-p-values-would-you-expect"><i class="fa fa-check"></i>What p-values would you expect?</a></li>
<li class="chapter" data-level="1.2.1" data-path="hypothesis-testing.html"><a href="hypothesis-testing.html#further-reading"><i class="fa fa-check"></i><b>1.2.1</b> Further Reading</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="likelihood-statistics.html"><a href="likelihood-statistics.html"><i class="fa fa-check"></i><b>2</b> Likelihood Statistics</a>
<ul>
<li class="chapter" data-level="2.1" data-path="maximum-likelihood-estimation.html"><a href="maximum-likelihood-estimation.html"><i class="fa fa-check"></i><b>2.1</b> Maximum Likelihood Estimation</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="bayesian-statistics.html"><a href="bayesian-statistics.html"><i class="fa fa-check"></i><b>3</b> Bayesian Statistics</a>
<ul>
<li class="chapter" data-level="3.1" data-path="bayes-theorem.html"><a href="bayes-theorem.html"><i class="fa fa-check"></i><b>3.1</b> Bayes’ Theorem</a></li>
<li class="chapter" data-level="3.2" data-path="bayesian-inference.html"><a href="bayesian-inference.html"><i class="fa fa-check"></i><b>3.2</b> Bayesian Inference</a></li>
<li class="chapter" data-level="3.3" data-path="markov-chain-monte-carlo-mcmc.html"><a href="markov-chain-monte-carlo-mcmc.html"><i class="fa fa-check"></i><b>3.3</b> Markov Chain Monte Carlo (MCMC)</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="markov-chain-monte-carlo-mcmc.html"><a href="markov-chain-monte-carlo-mcmc.html#the-classical-approach"><i class="fa fa-check"></i><b>3.3.1</b> The Classical Approach</a></li>
<li class="chapter" data-level="3.3.2" data-path="markov-chain-monte-carlo-mcmc.html"><a href="markov-chain-monte-carlo-mcmc.html#rejection-sampling"><i class="fa fa-check"></i><b>3.3.2</b> Rejection Sampling</a></li>
<li class="chapter" data-level="3.3.3" data-path="markov-chain-monte-carlo-mcmc.html"><a href="markov-chain-monte-carlo-mcmc.html#gibbs-sampler"><i class="fa fa-check"></i><b>3.3.3</b> Gibbs Sampler</a></li>
<li class="chapter" data-level="3.3.4" data-path="markov-chain-monte-carlo-mcmc.html"><a href="markov-chain-monte-carlo-mcmc.html#metropolis-hastings"><i class="fa fa-check"></i><b>3.3.4</b> Metropolis-Hastings</a></li>
<li class="chapter" data-level="3.3.5" data-path="markov-chain-monte-carlo-mcmc.html"><a href="markov-chain-monte-carlo-mcmc.html#other-notes"><i class="fa fa-check"></i><b>3.3.5</b> Other Notes</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="gamma-poisson-and-estimating-counts.html"><a href="gamma-poisson-and-estimating-counts.html"><i class="fa fa-check"></i><b>3.4</b> Gamma Poisson and Estimating Counts</a></li>
<li class="chapter" data-level="3.5" data-path="normal-and-estimating-means.html"><a href="normal-and-estimating-means.html"><i class="fa fa-check"></i><b>3.5</b> Normal and Estimating Means</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="normal-and-estimating-means.html"><a href="normal-and-estimating-means.html#normal-pop-est"><i class="fa fa-check"></i><b>3.5.1</b> Population Estimate</a></li>
<li class="chapter" data-level="3.5.2" data-path="normal-and-estimating-means.html"><a href="normal-and-estimating-means.html#regression"><i class="fa fa-check"></i><b>3.5.2</b> Regression</a></li>
<li class="chapter" data-level="3.5.3" data-path="normal-and-estimating-means.html"><a href="normal-and-estimating-means.html#generalized-linear-models"><i class="fa fa-check"></i><b>3.5.3</b> Generalized Linear Models</a></li>
<li class="chapter" data-level="3.5.4" data-path="normal-and-estimating-means.html"><a href="normal-and-estimating-means.html#missing-data"><i class="fa fa-check"></i><b>3.5.4</b> Missing Data</a></li>
<li class="chapter" data-level="3.5.5" data-path="normal-and-estimating-means.html"><a href="normal-and-estimating-means.html#change-point-regression"><i class="fa fa-check"></i><b>3.5.5</b> Change Point Regression</a></li>
<li class="chapter" data-level="3.5.6" data-path="normal-and-estimating-means.html"><a href="normal-and-estimating-means.html#cluster-analysis"><i class="fa fa-check"></i><b>3.5.6</b> Cluster Analysis</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="beta-binomial-and-estimating-proportions.html"><a href="beta-binomial-and-estimating-proportions.html"><i class="fa fa-check"></i><b>3.6</b> Beta Binomial and Estimating Proportions</a></li>
<li class="chapter" data-level="3.7" data-path="zero-inflation-and-latent-variables.html"><a href="zero-inflation-and-latent-variables.html"><i class="fa fa-check"></i><b>3.7</b> Zero-Inflation and Latent Variables</a></li>
<li class="chapter" data-level="3.8" data-path="dic.html"><a href="dic.html"><i class="fa fa-check"></i><b>3.8</b> DIC</a></li>
<li class="chapter" data-level="3.9" data-path="monte-carlo-integration.html"><a href="monte-carlo-integration.html"><i class="fa fa-check"></i><b>3.9</b> Monte Carlo Integration</a>
<ul>
<li class="chapter" data-level="3.9.1" data-path="monte-carlo-integration.html"><a href="monte-carlo-integration.html#inverse-sampling"><i class="fa fa-check"></i><b>3.9.1</b> Inverse Sampling</a></li>
<li class="chapter" data-level="3.9.2" data-path="monte-carlo-integration.html"><a href="monte-carlo-integration.html#rejection-sampling-1"><i class="fa fa-check"></i><b>3.9.2</b> Rejection Sampling</a></li>
<li class="chapter" data-level="3.9.3" data-path="monte-carlo-integration.html"><a href="monte-carlo-integration.html#importance-sampling"><i class="fa fa-check"></i><b>3.9.3</b> Importance Sampling</a></li>
</ul></li>
<li class="chapter" data-level="3.10" data-path="metropolis-hastings-1.html"><a href="metropolis-hastings-1.html"><i class="fa fa-check"></i><b>3.10</b> Metropolis-Hastings</a></li>
<li class="chapter" data-level="3.11" data-path="mixed-effects-linear-regression.html"><a href="mixed-effects-linear-regression.html"><i class="fa fa-check"></i><b>3.11</b> Mixed Effects Linear Regression</a></li>
<li class="chapter" data-level="3.12" data-path="appendix-bayes-factors.html"><a href="appendix-bayes-factors.html"><i class="fa fa-check"></i><b>3.12</b> Appendix: Bayes Factors</a></li>
<li class="chapter" data-level="3.13" data-path="further-reading-1.html"><a href="further-reading-1.html"><i class="fa fa-check"></i><b>3.13</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="one-sample.html"><a href="one-sample.html"><i class="fa fa-check"></i><b>4</b> One-Sample</a>
<ul>
<li class="chapter" data-level="4.1" data-path="one-sample-mean-z-test.html"><a href="one-sample-mean-z-test.html"><i class="fa fa-check"></i><b>4.1</b> One-Sample Mean z Test</a></li>
<li class="chapter" data-level="4.2" data-path="one-sample-mean-t-test.html"><a href="one-sample-mean-t-test.html"><i class="fa fa-check"></i><b>4.2</b> One-Sample Mean t Test</a></li>
<li class="chapter" data-level="4.3" data-path="one-sample-median-wilcoxon-test.html"><a href="one-sample-median-wilcoxon-test.html"><i class="fa fa-check"></i><b>4.3</b> One-Sample Median Wilcoxon Test</a></li>
<li class="chapter" data-level="4.4" data-path="chi-squared-goodness-of-fit-test.html"><a href="chi-squared-goodness-of-fit-test.html"><i class="fa fa-check"></i><b>4.4</b> Chi-Squared Goodness-of-Fit Test</a></li>
<li class="chapter" data-level="4.5" data-path="g-test.html"><a href="g-test.html"><i class="fa fa-check"></i><b>4.5</b> G-Test</a></li>
<li class="chapter" data-level="4.6" data-path="one-sample-poisson-test.html"><a href="one-sample-poisson-test.html"><i class="fa fa-check"></i><b>4.6</b> One-Sample Poisson Test</a></li>
<li class="chapter" data-level="4.7" data-path="exact-binomial-test.html"><a href="exact-binomial-test.html"><i class="fa fa-check"></i><b>4.7</b> Exact Binomial Test</a></li>
<li class="chapter" data-level="4.8" data-path="one-sample-proportion-z-test.html"><a href="one-sample-proportion-z-test.html"><i class="fa fa-check"></i><b>4.8</b> One-Sample Proportion z Test</a></li>
<li class="chapter" data-level="4.9" data-path="sample-t-test-for-categorical-var.html"><a href="sample-t-test-for-categorical-var.html"><i class="fa fa-check"></i><b>4.9</b> 1 sample t Test for Categorical Var</a></li>
<li class="chapter" data-level="4.10" data-path="wilcoxon-1-sample-median-test-for-categorical-var.html"><a href="wilcoxon-1-sample-median-test-for-categorical-var.html"><i class="fa fa-check"></i><b>4.10</b> Wilcoxon 1-Sample Median Test for Categorical Var</a></li>
<li class="chapter" data-level="4.11" data-path="multivariate-statistics.html"><a href="multivariate-statistics.html"><i class="fa fa-check"></i><b>4.11</b> Multivariate Statistics</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="group-differences.html"><a href="group-differences.html"><i class="fa fa-check"></i><b>5</b> Group Differences</a>
<ul>
<li class="chapter" data-level="5.1" data-path="ttest.html"><a href="ttest.html"><i class="fa fa-check"></i><b>5.1</b> Independent Samples t-Test</a></li>
<li class="chapter" data-level="5.2" data-path="wilcoxonranksum.html"><a href="wilcoxonranksum.html"><i class="fa fa-check"></i><b>5.2</b> Wilcoxon Rank Sum Test</a></li>
<li class="chapter" data-level="" data-path="case-study-1.html"><a href="case-study-1.html"><i class="fa fa-check"></i>Case Study 1</a></li>
<li class="chapter" data-level="5.3" data-path="pairedttest.html"><a href="pairedttest.html"><i class="fa fa-check"></i><b>5.3</b> Paired Samples t-Test</a></li>
<li class="chapter" data-level="5.4" data-path="wilcoxonsignedrank.html"><a href="wilcoxonsignedrank.html"><i class="fa fa-check"></i><b>5.4</b> Wilcoxon Signed-Rank Test</a>
<ul>
<li class="chapter" data-level="" data-path="wilcoxonsignedrank.html"><a href="wilcoxonsignedrank.html#sign-test"><i class="fa fa-check"></i>Sign Test</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="case-study-2.html"><a href="case-study-2.html"><i class="fa fa-check"></i>Case Study 2</a></li>
<li class="chapter" data-level="5.5" data-path="onewayanova.html"><a href="onewayanova.html"><i class="fa fa-check"></i><b>5.5</b> One-way ANOVA</a></li>
<li class="chapter" data-level="5.6" data-path="kw.html"><a href="kw.html"><i class="fa fa-check"></i><b>5.6</b> Kruskal–Wallis Test</a></li>
<li class="chapter" data-level="" data-path="groupdiffscs3.html"><a href="groupdiffscs3.html"><i class="fa fa-check"></i>Case Study 3</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="groupdiffscs3.html"><a href="groupdiffscs3.html#assumptions"><i class="fa fa-check"></i><b>5.6.1</b> Assumptions</a></li>
<li class="chapter" data-level="5.6.2" data-path="groupdiffscs3.html"><a href="groupdiffscs3.html#anova"><i class="fa fa-check"></i><b>5.6.2</b> ANOVA</a></li>
<li class="chapter" data-level="5.6.3" data-path="groupdiffscs3.html"><a href="groupdiffscs3.html#kruskal-wallis-test"><i class="fa fa-check"></i><b>5.6.3</b> Kruskal-Wallis Test</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="chisqhomogeneity.html"><a href="chisqhomogeneity.html"><i class="fa fa-check"></i><b>5.7</b> Chi-Square Test of Homogeneity</a></li>
<li class="chapter" data-level="5.8" data-path="fisherexact.html"><a href="fisherexact.html"><i class="fa fa-check"></i><b>5.8</b> Fisher’s Exact Test</a></li>
<li class="chapter" data-level="" data-path="case-study-4.html"><a href="case-study-4.html"><i class="fa fa-check"></i>Case Study 4</a></li>
<li class="chapter" data-level="5.9" data-path="pairwiseproptest.html"><a href="pairwiseproptest.html"><i class="fa fa-check"></i><b>5.9</b> Pairwise Prop Test</a></li>
<li class="chapter" data-level="5.10" data-path="mcnemar.html"><a href="mcnemar.html"><i class="fa fa-check"></i><b>5.10</b> McNemar’s Test</a>
<ul>
<li class="chapter" data-level="5.10.1" data-path="mcnemar.html"><a href="mcnemar.html#manova"><i class="fa fa-check"></i><b>5.10.1</b> MANOVA</a></li>
<li class="chapter" data-level="5.10.2" data-path="mcnemar.html"><a href="mcnemar.html#multiple-variance-comparison-f-test"><i class="fa fa-check"></i><b>5.10.2</b> Multiple Variance Comparison F Test</a></li>
<li class="chapter" data-level="5.10.3" data-path="mcnemar.html"><a href="mcnemar.html#example-5"><i class="fa fa-check"></i><b>5.10.3</b> Example</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="association.html"><a href="association.html"><i class="fa fa-check"></i><b>6</b> Association</a>
<ul>
<li class="chapter" data-level="6.1" data-path="pearson.html"><a href="pearson.html"><i class="fa fa-check"></i><b>6.1</b> Pearson’s Correlation</a></li>
<li class="chapter" data-level="6.2" data-path="spearman.html"><a href="spearman.html"><i class="fa fa-check"></i><b>6.2</b> Spearman’s Rho</a></li>
<li class="chapter" data-level="6.3" data-path="kendall.html"><a href="kendall.html"><i class="fa fa-check"></i><b>6.3</b> Kendal’s Tau</a></li>
<li class="chapter" data-level="6.4" data-path="case-study-pearson-spearman-kendall.html"><a href="case-study-pearson-spearman-kendall.html"><i class="fa fa-check"></i><b>6.4</b> Case Study: Pearson, Spearman, Kendall</a></li>
<li class="chapter" data-level="6.5" data-path="chisq-independence.html"><a href="chisq-independence.html"><i class="fa fa-check"></i><b>6.5</b> Chi-Square Test of Independence</a></li>
<li class="chapter" data-level="6.6" data-path="fisher-exact.html"><a href="fisher-exact.html"><i class="fa fa-check"></i><b>6.6</b> Fisher’s Exact Test</a></li>
<li class="chapter" data-level="6.7" data-path="case-study-chi-square-fisher.html"><a href="case-study-chi-square-fisher.html"><i class="fa fa-check"></i><b>6.7</b> Case Study: Chi-Square, Fisher</a></li>
<li class="chapter" data-level="6.8" data-path="kruskals-lambda.html"><a href="kruskals-lambda.html"><i class="fa fa-check"></i><b>6.8</b> Kruskal’s Lambda</a></li>
<li class="chapter" data-level="6.9" data-path="relative-risk.html"><a href="relative-risk.html"><i class="fa fa-check"></i><b>6.9</b> Relative Risk</a></li>
<li class="chapter" data-level="6.10" data-path="odds-ratio.html"><a href="odds-ratio.html"><i class="fa fa-check"></i><b>6.10</b> Odds Ratio</a></li>
<li class="chapter" data-level="6.11" data-path="partial-correlation.html"><a href="partial-correlation.html"><i class="fa fa-check"></i><b>6.11</b> Partial Correlation</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="matrix-algebra.html"><a href="matrix-algebra.html"><i class="fa fa-check"></i><b>7</b> Matrix Algebra</a>
<ul>
<li class="chapter" data-level="7.1" data-path="central-tendancy-dispersion-and-association.html"><a href="central-tendancy-dispersion-and-association.html"><i class="fa fa-check"></i><b>7.1</b> Central Tendancy, Dispersion, and Association</a></li>
<li class="chapter" data-level="7.2" data-path="linear-transformations.html"><a href="linear-transformations.html"><i class="fa fa-check"></i><b>7.2</b> Linear Transformations</a></li>
<li class="chapter" data-level="7.3" data-path="multivariate-normal-distribution.html"><a href="multivariate-normal-distribution.html"><i class="fa fa-check"></i><b>7.3</b> Multivariate Normal Distribution</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Inference</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="normal-and-estimating-means" class="section level2 hasAnchor" number="3.5">
<h2><span class="header-section-number">3.5</span> Normal and Estimating Means<a href="normal-and-estimating-means.html#normal-and-estimating-means" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="normal-pop-est" class="section level3 hasAnchor" number="3.5.1">
<h3><span class="header-section-number">3.5.1</span> Population Estimate<a href="normal-and-estimating-means.html#normal-pop-est" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Suppose you have a sample, <span class="math inline">\(\textbf{y}\)</span>, from a normally distribution population of unknown mean and precision, <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\tau\)</span>: <span class="math inline">\(y_i|\mu, \tau \sim N(\mu, \tau)\)</span>.<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a> Assume a normal prior for <span class="math inline">\(\mu \sim N(\mu_0, \tau_0)\)</span>, and a gamma prior for <span class="math inline">\(\tau \sim \text{Gamma}(a, b)\)</span> since it takes only positive values. The PDF for <span class="math inline">\(y_i\)</span> is <span class="math inline">\(f(y_i | \mu, \tau) = \frac{\tau^{.5}}{\sqrt{2\pi}} \exp\left(-\frac{\tau}{2} (y_i - \mu)^2 \right)\)</span>. We’ll derive posterior distributions for <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\tau\)</span> separately.</p>
<p>Using Bayes’ Theorem, the posterior distribution of <span class="math inline">\(\mu|y\)</span> is the joint likelihood of <span class="math inline">\(y\)</span> and <span class="math inline">\(\mu\)</span> divided by the likelihood of <span class="math inline">\(y\)</span>,</p>
<p><span class="math display">\[
f(\mu|y) = \frac{f(y|\mu)f(\mu)}{\int_\mu f(y|\mu)f(\mu)d\mu}
\]</span></p>
<p>The conditional likelihood, <span class="math inline">\(f(\mu|y)\)</span>, is the sum-product of the normal distribution PDF. We can take <span class="math inline">\(\tau\)</span> as given initially.</p>
<p><span class="math display">\[
\begin{align}
f(y|\mu) &amp;= \prod_i \frac{\tau^{(1/2)}}{\sqrt{2\pi}} \exp\left(-\frac{\tau}{2} (y_i - \mu)^2 \right) \\
&amp;\propto \prod_i \exp\left(-\frac{\tau}{2} (y_i - \mu)^2 \right) \\
&amp;\propto \exp \left( -\frac{\tau}{2} \sum_i(y_i - \mu)^2 \right)
\end{align}
\]</span></p>
<p>The prior PDF for <span class="math inline">\(\mu\)</span> is the normal distribution. Again we take <span class="math inline">\(\tau\)</span> as given initially.</p>
<p><span class="math display">\[
\begin{align}
f(\mu) &amp;= \frac{\tau_0^{1/2}}{\sqrt{2\pi}} \exp\left(-\frac{\tau_0}{2} (\mu - \mu_0)^2 \right) \\
&amp;\propto \exp\left(-\frac{\tau_0}{2} (\mu - \mu_0)^2 \right)  
\end{align}
\]</span></p>
<p>Substitute into Bayes’ Theorem. Since we are working with proportions, we can throw out the denominator and say <span class="math inline">\(f(\mu|y) \propto f(y|\mu)f(\mu)\)</span>. Plugging in and solving, we get</p>
<p><span class="math display" id="eq:mu-posterior">\[
\begin{equation}
\mu|y \sim N\left(\frac{n\tau\bar{y} + \tau_0\mu_0}{n\tau + \tau_0}, n\tau + \tau_0 \right)
\tag{3.2}
\end{equation}
\]</span></p>
<p>Using Bayes’ Theorem, the posterior distribution of <span class="math inline">\(\tau|y\)</span> is the joint likelihood of <span class="math inline">\(y\)</span> and <span class="math inline">\(\tau\)</span> divided by the likelihood of <span class="math inline">\(y\)</span>,</p>
<p><span class="math display">\[
f(\tau|y) = \frac{f(y|\tau)f(\tau)}{\int_\tau f(y|\mu)f(\tau)d\tau}
\]</span></p>
<p>The conditional likelihood, <span class="math inline">\(f(\tau|y)\)</span>, is the sum-product of the gamma distribution PDF. This time we take <span class="math inline">\(\mu\)</span> as given.</p>
<p><span class="math display">\[
\begin{align}
f(y|\tau) &amp;= \prod_i \frac{\tau^{(1/2)}}{\sqrt{2\pi}} \exp\left(-\frac{\tau}{2} (y_i - \mu)^2 \right) \\
&amp;= \frac{\tau^{n/2}}{(2\pi)^{n/2}} \exp\left(-\frac{\tau}{2} \sum_i (y_i - \mu)^2 \right) \\
&amp;\propto \tau^{n/2} \exp \left( -\frac{\tau}{2} \sum_i(y_i - \mu)^2 \right)
\end{align}
\]</span></p>
<p>The prior PDF for <span class="math inline">\(\tau\)</span> is the gamma distribution. Pull the constant out to work with proportionality.</p>
<p><span class="math display">\[
\begin{align}
f(\tau) &amp;= \frac{b^a \tau^{a-1} e^{-b\tau}}{\Gamma(a)} \\
&amp;\propto \tau^{a-1}e^{-b\tau}
\end{align}
\]</span></p>
<p>Substitute into Bayes’ Theorem. Since we are working with proportions, we can throw out the denominator and say <span class="math inline">\(f(\tau|y) \propto f(y|\tau)f(\tau)\)</span>. Plugging in and solving, we get</p>
<p><span class="math display" id="eq:tau-posterior">\[
\begin{equation}
\tau|y \sim \text{Gamma}\left(a + n/2, b + \frac{1}{2} \sum_i(y_i - \mu)^2 \right)
\tag{3.3}
\end{equation}
\]</span></p>
<p>We have <span class="math inline">\(y_i|\mu,\tau \sim N(\mu,\tau)\)</span> with conjugate priors <span class="math inline">\(\mu \sim N(\mu_0, \tau_0)\)</span> and <span class="math inline">\(\tau \sim \text{Gamma}(a,b)\)</span> and conditional posterior distributions shown in Eqns <a href="normal-and-estimating-means.html#eq:mu-posterior">(3.2)</a> and <a href="normal-and-estimating-means.html#eq:tau-posterior">(3.3)</a>. Returning to Eqn <a href="normal-and-estimating-means.html#eq:mu-posterior">(3.2)</a>, you can see how <span class="math inline">\(E[\mu] \rightarrow \bar{y}\)</span> as the sample size grows. Below, the terms divided by <span class="math inline">\(n\)</span> disappear, leaving just <span class="math inline">\(\bar{y}\)</span>.</p>
<p><span class="math display">\[
\begin{align}
E[\mu|\tau, y] &amp;= \frac{n\tau\bar{y} + \tau_0\mu_0}{n\tau + \tau_0} \\
&amp;= \frac{\bar{y}\tau + \mu_0\tau_0/n}{\tau + \tau_0/n} \\
&amp;\sim \bar{y}
\end{align}
\]</span></p>
<p>The posterior mean estimator of <span class="math inline">\(\tau\)</span> is the ratio of the posterior gamma distribution parameters. Again, as the sample size increases, terms divided by <span class="math inline">\(n\)</span> disappear.</p>
<p><span class="math display">\[
\begin{align}
E[\tau|\mu,y] &amp;= \frac{a + n/2}{b + \frac{1}{2} \sum_i(y_i - \mu)^2} \\
&amp;= \frac{2a/n + 1}{2b/n + \sum_i(y_i - \mu)^2 / n} \\
&amp;\sim \frac{1}{\sum_i(y_i - \mu)^2}
\end{align}
\]</span></p>
<p>The problem here is that you never know <span class="math inline">\(\mu\)</span> or <span class="math inline">\(\tau\)</span>, so you cannot use the posterior formulas directly. Instead, you need to use sampling. In particular, you use the <em>Gibbs sampler</em>. Set <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\tau\)</span> to some initial values and use the posterior equations to estimate new values for <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\tau\)</span>, then repeat. This is called Markov Chain Monte Carlo (MCMC) simulation because you are chaining the simulations. The method of sampling from a conditional posterior is called the Gibbs sampler.</p>
<p>Let’s apply this using anthropological data collected by Nancy Howell of human height.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="normal-and-estimating-means.html#cb64-1" tabindex="-1"></a><span class="co"># downloaded this from </span></span>
<span id="cb64-2"><a href="normal-and-estimating-means.html#cb64-2" tabindex="-1"></a><span class="co"># https://github.com/rmcelreath/rethinking/blob/master/data/Howell1.csv</span></span>
<span id="cb64-3"><a href="normal-and-estimating-means.html#cb64-3" tabindex="-1"></a>howell <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">&quot;input/Howell1.csv&quot;</span>, <span class="at">delim =</span> <span class="st">&quot;;&quot;</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-4"><a href="normal-and-estimating-means.html#cb64-4" tabindex="-1"></a>  <span class="fu">filter</span>(age <span class="sc">&gt;=</span> <span class="dv">18</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-5"><a href="normal-and-estimating-means.html#cb64-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">male =</span> <span class="fu">factor</span>(male, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;women&quot;</span>, <span class="st">&quot;men&quot;</span>)))</span>
<span id="cb64-6"><a href="normal-and-estimating-means.html#cb64-6" tabindex="-1"></a></span>
<span id="cb64-7"><a href="normal-and-estimating-means.html#cb64-7" tabindex="-1"></a>howell <span class="sc">%&gt;%</span></span>
<span id="cb64-8"><a href="normal-and-estimating-means.html#cb64-8" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">sample =</span> height, <span class="at">color =</span> male)) <span class="sc">+</span></span>
<span id="cb64-9"><a href="normal-and-estimating-means.html#cb64-9" tabindex="-1"></a>  <span class="fu">stat_qq</span>() <span class="sc">+</span></span>
<span id="cb64-10"><a href="normal-and-estimating-means.html#cb64-10" tabindex="-1"></a>  <span class="fu">geom_qq_line</span>()</span></code></pre></div>
<p><img src="statistics_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<p>From prior knowledge, we know average human height is about <span class="math inline">\(175 \pm 10\)</span> cm. Using the <span class="math inline">\(\pm\)</span> = 2SD, the variance <span class="math inline">\(5^2\)</span>. Use vague priors of <span class="math inline">\(\mu \sim N(\mu_0 = 175, \tau_0 = 1/5^2)\)</span> and <span class="math inline">\(\tau = \sim \text{Gamma}(a = .01, b = .01)\)</span>. Start by assigning starting values, <span class="math inline">\(\mu*\)</span> and <span class="math inline">\(\tau*\)</span>). Given <span class="math inline">\(\tau = \tau*\)</span>, sample a new value of <span class="math inline">\(\mu*\)</span> from the normal distribution. Given <span class="math inline">\(\mu = \mu*\)</span>, sample a new value of <span class="math inline">\(\tau*\)</span> from the gamma distribution. Then repeat.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="normal-and-estimating-means.html#cb65-1" tabindex="-1"></a>gibbs_normal <span class="ot">&lt;-</span> <span class="cf">function</span>(y, mu_0, tau_0, a, b, n_iter){</span>
<span id="cb65-2"><a href="normal-and-estimating-means.html#cb65-2" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(y)</span>
<span id="cb65-3"><a href="normal-and-estimating-means.html#cb65-3" tabindex="-1"></a>  y_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(y)</span>
<span id="cb65-4"><a href="normal-and-estimating-means.html#cb65-4" tabindex="-1"></a>  </span>
<span id="cb65-5"><a href="normal-and-estimating-means.html#cb65-5" tabindex="-1"></a>  mu_sample <span class="ot">&lt;-</span> tau_sample <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_iter)</span>
<span id="cb65-6"><a href="normal-and-estimating-means.html#cb65-6" tabindex="-1"></a>  </span>
<span id="cb65-7"><a href="normal-and-estimating-means.html#cb65-7" tabindex="-1"></a>  <span class="co"># starting values</span></span>
<span id="cb65-8"><a href="normal-and-estimating-means.html#cb65-8" tabindex="-1"></a>  mu_sample[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(y)</span>
<span id="cb65-9"><a href="normal-and-estimating-means.html#cb65-9" tabindex="-1"></a>  tau_sample[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> <span class="fu">var</span>(y)</span>
<span id="cb65-10"><a href="normal-and-estimating-means.html#cb65-10" tabindex="-1"></a></span>
<span id="cb65-11"><a href="normal-and-estimating-means.html#cb65-11" tabindex="-1"></a>  <span class="co"># Gibbs sampler</span></span>
<span id="cb65-12"><a href="normal-and-estimating-means.html#cb65-12" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n_iter){</span>
<span id="cb65-13"><a href="normal-and-estimating-means.html#cb65-13" tabindex="-1"></a>    <span class="co"># mu</span></span>
<span id="cb65-14"><a href="normal-and-estimating-means.html#cb65-14" tabindex="-1"></a>    tau <span class="ot">&lt;-</span> tau_sample[i<span class="dv">-1</span>]</span>
<span id="cb65-15"><a href="normal-and-estimating-means.html#cb65-15" tabindex="-1"></a>    mean_mu <span class="ot">&lt;-</span> (n <span class="sc">*</span> y_mean <span class="sc">*</span> tau <span class="sc">+</span> mu_0 <span class="sc">*</span> tau_0) <span class="sc">/</span> (n <span class="sc">*</span> tau <span class="sc">+</span> tau_0)</span>
<span id="cb65-16"><a href="normal-and-estimating-means.html#cb65-16" tabindex="-1"></a>    precision_mu <span class="ot">&lt;-</span> n <span class="sc">*</span> tau <span class="sc">+</span> tau_0</span>
<span id="cb65-17"><a href="normal-and-estimating-means.html#cb65-17" tabindex="-1"></a>    mu_sample[i] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, mean_mu, <span class="dv">1</span> <span class="sc">/</span> <span class="fu">sqrt</span>(precision_mu))</span>
<span id="cb65-18"><a href="normal-and-estimating-means.html#cb65-18" tabindex="-1"></a>    <span class="co"># tau</span></span>
<span id="cb65-19"><a href="normal-and-estimating-means.html#cb65-19" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> mu_sample[i<span class="dv">-1</span>]</span>
<span id="cb65-20"><a href="normal-and-estimating-means.html#cb65-20" tabindex="-1"></a>    tau_sample[i] <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(<span class="dv">1</span>, a <span class="sc">+</span> n<span class="sc">/</span><span class="dv">2</span>, b <span class="sc">+</span> .<span class="dv">5</span> <span class="sc">*</span> <span class="fu">sum</span>((y <span class="sc">-</span> mu)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb65-21"><a href="normal-and-estimating-means.html#cb65-21" tabindex="-1"></a>  }</span>
<span id="cb65-22"><a href="normal-and-estimating-means.html#cb65-22" tabindex="-1"></a>  </span>
<span id="cb65-23"><a href="normal-and-estimating-means.html#cb65-23" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">mu =</span> mu_sample, <span class="at">tau =</span> tau_sample))</span>
<span id="cb65-24"><a href="normal-and-estimating-means.html#cb65-24" tabindex="-1"></a>}</span>
<span id="cb65-25"><a href="normal-and-estimating-means.html#cb65-25" tabindex="-1"></a></span>
<span id="cb65-26"><a href="normal-and-estimating-means.html#cb65-26" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb65-27"><a href="normal-and-estimating-means.html#cb65-27" tabindex="-1"></a>sample_m <span class="ot">&lt;-</span> <span class="fu">gibbs_normal</span>(howell[howell<span class="sc">$</span>male <span class="sc">==</span> <span class="st">&quot;men&quot;</span>,]<span class="sc">$</span>height, <span class="dv">175</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span><span class="sc">^</span><span class="dv">2</span>, .<span class="dv">01</span>, .<span class="dv">01</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">3</span>)</span>
<span id="cb65-28"><a href="normal-and-estimating-means.html#cb65-28" tabindex="-1"></a>sample_w <span class="ot">&lt;-</span> <span class="fu">gibbs_normal</span>(howell[howell<span class="sc">$</span>male <span class="sc">==</span> <span class="st">&quot;women&quot;</span>,]<span class="sc">$</span>height, <span class="dv">175</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span><span class="sc">^</span><span class="dv">2</span>, .<span class="dv">01</span>, .<span class="dv">01</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">3</span>)</span>
<span id="cb65-29"><a href="normal-and-estimating-means.html#cb65-29" tabindex="-1"></a></span>
<span id="cb65-30"><a href="normal-and-estimating-means.html#cb65-30" tabindex="-1"></a><span class="co"># posterior mu</span></span>
<span id="cb65-31"><a href="normal-and-estimating-means.html#cb65-31" tabindex="-1"></a><span class="fu">mean</span>(sample_m<span class="sc">$</span>mu); <span class="fu">quantile</span>(sample_m<span class="sc">$</span>mu, <span class="fu">c</span>(.<span class="dv">025</span>, .<span class="dv">975</span>))</span>
<span id="cb65-32"><a href="normal-and-estimating-means.html#cb65-32" tabindex="-1"></a><span class="do">## [1] 160.5146</span></span>
<span id="cb65-33"><a href="normal-and-estimating-means.html#cb65-33" tabindex="-1"></a><span class="do">##     2.5%    97.5% </span></span>
<span id="cb65-34"><a href="normal-and-estimating-means.html#cb65-34" tabindex="-1"></a><span class="do">## 159.6103 161.4231</span></span>
<span id="cb65-35"><a href="normal-and-estimating-means.html#cb65-35" tabindex="-1"></a><span class="fu">mean</span>(sample_w<span class="sc">$</span>mu); <span class="fu">quantile</span>(sample_w<span class="sc">$</span>mu, <span class="fu">c</span>(.<span class="dv">025</span>, .<span class="dv">975</span>))</span>
<span id="cb65-36"><a href="normal-and-estimating-means.html#cb65-36" tabindex="-1"></a><span class="do">## [1] 149.6363</span></span>
<span id="cb65-37"><a href="normal-and-estimating-means.html#cb65-37" tabindex="-1"></a><span class="do">##     2.5%    97.5% </span></span>
<span id="cb65-38"><a href="normal-and-estimating-means.html#cb65-38" tabindex="-1"></a><span class="do">## 148.9256 150.3641</span></span>
<span id="cb65-39"><a href="normal-and-estimating-means.html#cb65-39" tabindex="-1"></a></span>
<span id="cb65-40"><a href="normal-and-estimating-means.html#cb65-40" tabindex="-1"></a><span class="co"># posterior probability that men are taller than women on average</span></span>
<span id="cb65-41"><a href="normal-and-estimating-means.html#cb65-41" tabindex="-1"></a><span class="fu">mean</span>(sample_m<span class="sc">$</span>mu <span class="sc">&gt;</span> sample_w<span class="sc">$</span>mu)</span>
<span id="cb65-42"><a href="normal-and-estimating-means.html#cb65-42" tabindex="-1"></a><span class="do">## [1] 1</span></span>
<span id="cb65-43"><a href="normal-and-estimating-means.html#cb65-43" tabindex="-1"></a></span>
<span id="cb65-44"><a href="normal-and-estimating-means.html#cb65-44" tabindex="-1"></a><span class="co"># posterior probability that a random man is taller than a random woman</span></span>
<span id="cb65-45"><a href="normal-and-estimating-means.html#cb65-45" tabindex="-1"></a>tilde_m <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10</span><span class="sc">^</span><span class="dv">3</span>, <span class="fu">mean</span>(sample_m<span class="sc">$</span>mu), <span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">mean</span>(sample_m<span class="sc">$</span>tau)))</span>
<span id="cb65-46"><a href="normal-and-estimating-means.html#cb65-46" tabindex="-1"></a>tilde_w <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10</span><span class="sc">^</span><span class="dv">3</span>, <span class="fu">mean</span>(sample_w<span class="sc">$</span>mu), <span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">mean</span>(sample_w<span class="sc">$</span>tau)))</span>
<span id="cb65-47"><a href="normal-and-estimating-means.html#cb65-47" tabindex="-1"></a><span class="fu">mean</span>(tilde_m <span class="sc">&gt;</span> tilde_w)</span>
<span id="cb65-48"><a href="normal-and-estimating-means.html#cb65-48" tabindex="-1"></a><span class="do">## [1] 0.909</span></span>
<span id="cb65-49"><a href="normal-and-estimating-means.html#cb65-49" tabindex="-1"></a></span>
<span id="cb65-50"><a href="normal-and-estimating-means.html#cb65-50" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb65-51"><a href="normal-and-estimating-means.html#cb65-51" tabindex="-1"></a>  <span class="at">iter =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span><span class="sc">^</span><span class="dv">3</span>, <span class="dv">2</span>),</span>
<span id="cb65-52"><a href="normal-and-estimating-means.html#cb65-52" tabindex="-1"></a>  <span class="at">sex =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;men&quot;</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">3</span>), <span class="fu">rep</span>(<span class="st">&quot;women&quot;</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">3</span>)),</span>
<span id="cb65-53"><a href="normal-and-estimating-means.html#cb65-53" tabindex="-1"></a>  <span class="at">mu =</span> <span class="fu">c</span>(sample_m<span class="sc">$</span>mu, sample_w<span class="sc">$</span>mu),</span>
<span id="cb65-54"><a href="normal-and-estimating-means.html#cb65-54" tabindex="-1"></a>  <span class="at">tau =</span> <span class="fu">c</span>(sample_m<span class="sc">$</span>tau, sample_w<span class="sc">$</span>tau),</span>
<span id="cb65-55"><a href="normal-and-estimating-means.html#cb65-55" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb65-56"><a href="normal-and-estimating-means.html#cb65-56" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(mu, tau)) <span class="sc">%&gt;%</span> </span>
<span id="cb65-57"><a href="normal-and-estimating-means.html#cb65-57" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">color =</span> sex)) <span class="sc">+</span> </span>
<span id="cb65-58"><a href="normal-and-estimating-means.html#cb65-58" tabindex="-1"></a>  <span class="fu">geom_density</span>() <span class="sc">+</span> </span>
<span id="cb65-59"><a href="normal-and-estimating-means.html#cb65-59" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span> <span class="fu">vars</span>(name), <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb65-60"><a href="normal-and-estimating-means.html#cb65-60" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Posterior Distributions&quot;</span>, <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">color =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="statistics_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="normal-and-estimating-means.html#cb66-1" tabindex="-1"></a></span>
<span id="cb66-2"><a href="normal-and-estimating-means.html#cb66-2" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb66-3"><a href="normal-and-estimating-means.html#cb66-3" tabindex="-1"></a>  <span class="at">iter =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span><span class="sc">^</span><span class="dv">3</span>, <span class="dv">2</span>),</span>
<span id="cb66-4"><a href="normal-and-estimating-means.html#cb66-4" tabindex="-1"></a>  <span class="at">sex =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;men&quot;</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">3</span>), <span class="fu">rep</span>(<span class="st">&quot;women&quot;</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">3</span>)),</span>
<span id="cb66-5"><a href="normal-and-estimating-means.html#cb66-5" tabindex="-1"></a>  <span class="at">tilde =</span> <span class="fu">c</span>(tilde_m, tilde_w)</span>
<span id="cb66-6"><a href="normal-and-estimating-means.html#cb66-6" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb66-7"><a href="normal-and-estimating-means.html#cb66-7" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> tilde, <span class="at">color =</span> sex)) <span class="sc">+</span> </span>
<span id="cb66-8"><a href="normal-and-estimating-means.html#cb66-8" tabindex="-1"></a>  <span class="fu">geom_density</span>() <span class="sc">+</span> </span>
<span id="cb66-9"><a href="normal-and-estimating-means.html#cb66-9" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Posterior Predictive Distributions&quot;</span>, <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">color =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="statistics_files/figure-html/unnamed-chunk-33-2.png" width="672" /></p>
<p>It may take some time to converge on a solution. This convergence is called <em>burn-in</em> and is often discarded when describing the posterior. <em>Slow mixing</em> may occur if there is high autocorrelation in the Gibbs sample, resulting in slow exploration of the sample space of the posterior.</p>
</div>
<div id="regression" class="section level3 hasAnchor" number="3.5.2">
<h3><span class="header-section-number">3.5.2</span> Regression<a href="normal-and-estimating-means.html#regression" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The linear model in Bayesian statistics is</p>
<p>Likelihood:</p>
<p><span class="math display">\[
y_i | \mu_i, \tau \sim N(\mu_i, \tau)
\]</span></p>
<p>where</p>
<p><span class="math display">\[
\mu_i | x_i, \beta_0, \beta_1 = \beta_0 + \beta_1 x
\]</span></p>
<p>Priors:</p>
<p><span class="math display">\[
\begin{align}
\beta_0 &amp; \sim N(0, 10^{-8}) \\
\beta_1 &amp; \sim N(0, 10^{-8}) \\
\tau &amp; \sim \text{Gamma}(.01, .01)
\end{align}
\]</span></p>
<p>Returning to the Howell data, suppose you want to fit a linear model, <span class="math inline">\(\text{Weight}_i = a + b \text{Height} + \epsilon_i\)</span>. In Bayesian regression, this is expressed as <span class="math inline">\(\text{Weight} | \mu_i \sim N(\mu_i, \tau)\)</span> where <span class="math inline">\(\mu_i = a + b\text{Height}\)</span>. You can construct a Gibbs sampler to estimate the model, but there is already a package for that, MCMCglmm.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="normal-and-estimating-means.html#cb67-1" tabindex="-1"></a><span class="fu">library</span>(MCMCglmm)</span>
<span id="cb67-2"><a href="normal-and-estimating-means.html#cb67-2" tabindex="-1"></a></span>
<span id="cb67-3"><a href="normal-and-estimating-means.html#cb67-3" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb67-4"><a href="normal-and-estimating-means.html#cb67-4" tabindex="-1"></a></span>
<span id="cb67-5"><a href="normal-and-estimating-means.html#cb67-5" tabindex="-1"></a>mdl_1 <span class="ot">&lt;-</span> <span class="fu">MCMCglmm</span>(</span>
<span id="cb67-6"><a href="normal-and-estimating-means.html#cb67-6" tabindex="-1"></a>  weight <span class="sc">~</span> height, </span>
<span id="cb67-7"><a href="normal-and-estimating-means.html#cb67-7" tabindex="-1"></a>  <span class="at">data =</span> howell,</span>
<span id="cb67-8"><a href="normal-and-estimating-means.html#cb67-8" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">&quot;gaussian&quot;</span>,</span>
<span id="cb67-9"><a href="normal-and-estimating-means.html#cb67-9" tabindex="-1"></a>  <span class="at">nitt =</span> <span class="dv">11000</span>, <span class="co"># iterations</span></span>
<span id="cb67-10"><a href="normal-and-estimating-means.html#cb67-10" tabindex="-1"></a>  <span class="at">burnin =</span> <span class="dv">1000</span>, <span class="co"># burn-in period to throw out</span></span>
<span id="cb67-11"><a href="normal-and-estimating-means.html#cb67-11" tabindex="-1"></a>  <span class="at">thin =</span> <span class="dv">10</span>, </span>
<span id="cb67-12"><a href="normal-and-estimating-means.html#cb67-12" tabindex="-1"></a>  <span class="co"># could omit this prior since it is non-informative</span></span>
<span id="cb67-13"><a href="normal-and-estimating-means.html#cb67-13" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">list</span>(<span class="at">B =</span> <span class="fu">list</span>(<span class="at">mu =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">V =</span> <span class="fu">c</span>(<span class="dv">100</span><span class="sc">^</span><span class="dv">2</span>, <span class="dv">100</span><span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span><span class="fu">diag</span>(<span class="dv">2</span>))),</span>
<span id="cb67-14"><a href="normal-and-estimating-means.html#cb67-14" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb67-15"><a href="normal-and-estimating-means.html#cb67-15" tabindex="-1"></a>)</span>
<span id="cb67-16"><a href="normal-and-estimating-means.html#cb67-16" tabindex="-1"></a></span>
<span id="cb67-17"><a href="normal-and-estimating-means.html#cb67-17" tabindex="-1"></a><span class="fu">summary</span>(mdl_1)</span></code></pre></div>
<pre><code>## 
##  Iterations = 1001:10991
##  Thinning interval  = 10
##  Sample size  = 1000 
## 
##  DIC: 2020.205 
## 
##  R-structure:  ~units
## 
##       post.mean l-95% CI u-95% CI eff.samp
## units     18.16    15.73    20.81     1000
## 
##  Location effects: weight ~ height 
## 
##             post.mean l-95% CI u-95% CI eff.samp  pMCMC    
## (Intercept)  -52.5503 -61.9377 -44.0584   1000.0 &lt;0.001 ***
## height         0.6309   0.5717   0.6874    912.8 &lt;0.001 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="normal-and-estimating-means.html#cb69-1" tabindex="-1"></a><span class="co"># Probability beta is &gt;0</span></span>
<span id="cb69-2"><a href="normal-and-estimating-means.html#cb69-2" tabindex="-1"></a><span class="fu">mean</span>(mdl_1<span class="sc">$</span>Sol[, <span class="dv">2</span>] <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="normal-and-estimating-means.html#cb71-1" tabindex="-1"></a><span class="co"># Posterior inference.</span></span>
<span id="cb71-2"><a href="normal-and-estimating-means.html#cb71-2" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">height =</span> <span class="fu">seq</span>(<span class="dv">130</span>, <span class="dv">185</span>, .<span class="dv">1</span>), <span class="at">weight =</span> <span class="dv">0</span>)</span>
<span id="cb71-3"><a href="normal-and-estimating-means.html#cb71-3" tabindex="-1"></a></span>
<span id="cb71-4"><a href="normal-and-estimating-means.html#cb71-4" tabindex="-1"></a>cred_intvl <span class="ot">&lt;-</span> <span class="fu">predict</span>(mdl_1, <span class="at">newdata =</span> , <span class="at">type =</span> <span class="st">&quot;response&quot;</span>, <span class="at">interval =</span> <span class="st">&quot;confidence&quot;</span>)</span>
<span id="cb71-5"><a href="normal-and-estimating-means.html#cb71-5" tabindex="-1"></a></span>
<span id="cb71-6"><a href="normal-and-estimating-means.html#cb71-6" tabindex="-1"></a>pred_intvl <span class="ot">&lt;-</span> <span class="fu">predict</span>(mdl_1, <span class="at">newdata =</span> , <span class="at">type =</span> <span class="st">&quot;response&quot;</span>, <span class="at">interval =</span> <span class="st">&quot;prediction&quot;</span>)</span>
<span id="cb71-7"><a href="normal-and-estimating-means.html#cb71-7" tabindex="-1"></a></span>
<span id="cb71-8"><a href="normal-and-estimating-means.html#cb71-8" tabindex="-1"></a>howell <span class="sc">%&gt;%</span> </span>
<span id="cb71-9"><a href="normal-and-estimating-means.html#cb71-9" tabindex="-1"></a>  <span class="fu">bind_cols</span>(cred_intvl, pred_intvl, <span class="at">.name_repair =</span> <span class="st">&quot;unique&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb71-10"><a href="normal-and-estimating-means.html#cb71-10" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> height)) <span class="sc">+</span></span>
<span id="cb71-11"><a href="normal-and-estimating-means.html#cb71-11" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> <span class="st">`</span><span class="at">lwr...9</span><span class="st">`</span>, <span class="at">ymax =</span> <span class="st">`</span><span class="at">upr...10</span><span class="st">`</span>), <span class="at">fill =</span> <span class="st">&quot;lightgoldenrod&quot;</span>, <span class="at">alpha =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb71-12"><a href="normal-and-estimating-means.html#cb71-12" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> <span class="st">`</span><span class="at">lwr...6</span><span class="st">`</span>, <span class="at">ymax =</span> <span class="st">`</span><span class="at">upr...7</span><span class="st">`</span>), <span class="at">fill =</span> <span class="st">&quot;goldenrod&quot;</span>, <span class="at">alpha =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb71-13"><a href="normal-and-estimating-means.html#cb71-13" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="st">`</span><span class="at">fit...5</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb71-14"><a href="normal-and-estimating-means.html#cb71-14" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> weight)) <span class="sc">+</span></span>
<span id="cb71-15"><a href="normal-and-estimating-means.html#cb71-15" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;weight&quot;</span>, <span class="at">title =</span> <span class="st">&quot;95% CI and PI.&quot;</span>)</span></code></pre></div>
<p><img src="statistics_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<p>You can extend this to multivariate models.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="normal-and-estimating-means.html#cb72-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb72-2"><a href="normal-and-estimating-means.html#cb72-2" tabindex="-1"></a></span>
<span id="cb72-3"><a href="normal-and-estimating-means.html#cb72-3" tabindex="-1"></a>mdl_2 <span class="ot">&lt;-</span> <span class="fu">MCMCglmm</span>(</span>
<span id="cb72-4"><a href="normal-and-estimating-means.html#cb72-4" tabindex="-1"></a>  weight <span class="sc">~</span> height<span class="sc">*</span>male, </span>
<span id="cb72-5"><a href="normal-and-estimating-means.html#cb72-5" tabindex="-1"></a>  <span class="at">data =</span> howell,</span>
<span id="cb72-6"><a href="normal-and-estimating-means.html#cb72-6" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">&quot;gaussian&quot;</span>,</span>
<span id="cb72-7"><a href="normal-and-estimating-means.html#cb72-7" tabindex="-1"></a>  <span class="at">nitt =</span> <span class="dv">11000</span>, <span class="co"># iterations</span></span>
<span id="cb72-8"><a href="normal-and-estimating-means.html#cb72-8" tabindex="-1"></a>  <span class="at">burnin =</span> <span class="dv">1000</span>, <span class="co"># burn-in period to throw out</span></span>
<span id="cb72-9"><a href="normal-and-estimating-means.html#cb72-9" tabindex="-1"></a>  <span class="at">thin =</span> <span class="dv">10</span>, </span>
<span id="cb72-10"><a href="normal-and-estimating-means.html#cb72-10" tabindex="-1"></a>  <span class="co">#prior = list(B = list(mu = c(0, 0), V = c(100^2, 100^2)*diag(2))), </span></span>
<span id="cb72-11"><a href="normal-and-estimating-means.html#cb72-11" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb72-12"><a href="normal-and-estimating-means.html#cb72-12" tabindex="-1"></a>)</span></code></pre></div>
<p>Bayesian statistics has its analog to Akaike’s Information Criterion (AIC) called Deviance Information Criterion (DIC).</p>
<p><span class="math display">\[
DIC = p_D + \overline{D(\theta)}
\]</span></p>
<p>where <span class="math inline">\(p_D = \overline{D(\theta)} - D(\hat{\theta})\)</span> and <span class="math inline">\(D(\theta) = -2 \log (f(y|\theta)) + C\)</span>. The value of DIC has no real meaning, but for comparison purposes, lower is better. A difference of at least 3 is considered sufficient evidence to choose one model over another. Here, <code>mdl_1$DIC</code> = 2020.2047497 and <code>mdl_2$DIC</code> = 2023.9678623. The first model is better, so conclude that there is no statistical evidence that the correlation between weight and height depends on sex (<span class="math inline">\(\Delta\)</span>DIC = 3.7631126).</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="normal-and-estimating-means.html#cb73-1" tabindex="-1"></a>mdl_3 <span class="ot">&lt;-</span> <span class="fu">MCMCglmm</span>(</span>
<span id="cb73-2"><a href="normal-and-estimating-means.html#cb73-2" tabindex="-1"></a>  weight <span class="sc">~</span> age, </span>
<span id="cb73-3"><a href="normal-and-estimating-means.html#cb73-3" tabindex="-1"></a>  <span class="at">data =</span> howell,</span>
<span id="cb73-4"><a href="normal-and-estimating-means.html#cb73-4" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">&quot;gaussian&quot;</span>,</span>
<span id="cb73-5"><a href="normal-and-estimating-means.html#cb73-5" tabindex="-1"></a>  <span class="at">nitt =</span> <span class="dv">11000</span>, <span class="co"># iterations</span></span>
<span id="cb73-6"><a href="normal-and-estimating-means.html#cb73-6" tabindex="-1"></a>  <span class="at">burnin =</span> <span class="dv">1000</span>, <span class="co"># burn-in period to throw out</span></span>
<span id="cb73-7"><a href="normal-and-estimating-means.html#cb73-7" tabindex="-1"></a>  <span class="at">thin =</span> <span class="dv">10</span>, </span>
<span id="cb73-8"><a href="normal-and-estimating-means.html#cb73-8" tabindex="-1"></a>  <span class="co">#prior = list(B = list(mu = c(0, 0), V = c(100^2, 100^2)*diag(2))), </span></span>
<span id="cb73-9"><a href="normal-and-estimating-means.html#cb73-9" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb73-10"><a href="normal-and-estimating-means.html#cb73-10" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Warning: Unknown or uninitialised column: `family`.</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="normal-and-estimating-means.html#cb75-1" tabindex="-1"></a><span class="fu">summary</span>(mdl_3)</span></code></pre></div>
<pre><code>## 
##  Iterations = 1001:10991
##  Thinning interval  = 10
##  Sample size  = 1000 
## 
##  DIC: 2306.323 
## 
##  R-structure:  ~units
## 
##       post.mean l-95% CI u-95% CI eff.samp
## units     40.94    35.44    47.38     1000
## 
##  Location effects: weight ~ age 
## 
##             post.mean l-95% CI u-95% CI eff.samp  pMCMC    
## (Intercept)  47.85552 46.15454 49.74972     1000 &lt;0.001 ***
## age          -0.06938 -0.10614 -0.02511     1000 &lt;0.001 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="normal-and-estimating-means.html#cb77-1" tabindex="-1"></a>mdl_1<span class="sc">$</span>DIC</span></code></pre></div>
<pre><code>## [1] 2020.205</code></pre>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="normal-and-estimating-means.html#cb79-1" tabindex="-1"></a>mdl_3<span class="sc">$</span>DIC</span></code></pre></div>
<pre><code>## [1] 2306.323</code></pre>
</div>
<div id="generalized-linear-models" class="section level3 hasAnchor" number="3.5.3">
<h3><span class="header-section-number">3.5.3</span> Generalized Linear Models<a href="normal-and-estimating-means.html#generalized-linear-models" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The generalized linear model in Bayesian statistics is</p>
<p>Likelihood:</p>
<p><span class="math display">\[
y_i | \mu_i, \tau \sim D(\mu_i)
\]</span></p>
<p>where</p>
<p><span class="math display">\[
g(\mu_i | x_i, \beta_0, \beta_1) = \beta_0 + \beta_1 x
\]</span></p>
<p>Priors:</p>
<p><span class="math display">\[
\begin{align}
\beta_0 &amp; \sim N(0, 10^{-8}) \\
\beta_1 &amp; \sim N(0, 10^{-8}) \\
\end{align}
\]</span></p>
<p>Consider a binary response <span class="math inline">\(y_i\)</span>. You would typically model this with logistic regression:</p>
<p><span class="math inline">\(y_i | p_i \sim \text{BIN}(1, p_i)\)</span> where <span class="math inline">\(\log \left( \frac{p_i}{1 - p_i} \right) = \beta_0 + \beta_1 x_i\)</span>. In bivariate statistics, if <span class="math inline">\(x_i\)</span> perfectly predicts <span class="math inline">\(y_i\)</span>, <em>separation of variables</em> has occurred. Here’s an example of separation of variables. In the regression, the standard errors are huge, so the p.value is nearly 1. The classical regression framework has broken down.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="normal-and-estimating-means.html#cb81-1" tabindex="-1"></a>study <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;input/hours_of_study_data.csv&quot;</span>, <span class="at">col_types =</span> <span class="st">&quot;dc&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-2"><a href="normal-and-estimating-means.html#cb81-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">factor</span>(y)) <span class="sc">%&gt;%</span></span>
<span id="cb81-3"><a href="normal-and-estimating-means.html#cb81-3" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb81-4"><a href="normal-and-estimating-means.html#cb81-4" tabindex="-1"></a></span>
<span id="cb81-5"><a href="normal-and-estimating-means.html#cb81-5" tabindex="-1"></a>study <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> HoursOfStudy, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="statistics_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="normal-and-estimating-means.html#cb82-1" tabindex="-1"></a></span>
<span id="cb82-2"><a href="normal-and-estimating-means.html#cb82-2" tabindex="-1"></a><span class="fu">summary</span>(</span>
<span id="cb82-3"><a href="normal-and-estimating-means.html#cb82-3" tabindex="-1"></a>  <span class="fu">glm</span>(y <span class="sc">~</span> HoursOfStudy, <span class="at">data =</span> study, <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb82-4"><a href="normal-and-estimating-means.html#cb82-4" tabindex="-1"></a>)</span>
<span id="cb82-5"><a href="normal-and-estimating-means.html#cb82-5" tabindex="-1"></a><span class="do">## Warning: glm.fit: algorithm did not converge</span></span>
<span id="cb82-6"><a href="normal-and-estimating-means.html#cb82-6" tabindex="-1"></a><span class="do">## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span id="cb82-7"><a href="normal-and-estimating-means.html#cb82-7" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb82-8"><a href="normal-and-estimating-means.html#cb82-8" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb82-9"><a href="normal-and-estimating-means.html#cb82-9" tabindex="-1"></a><span class="do">## glm(formula = y ~ HoursOfStudy, family = &quot;binomial&quot;, data = study)</span></span>
<span id="cb82-10"><a href="normal-and-estimating-means.html#cb82-10" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb82-11"><a href="normal-and-estimating-means.html#cb82-11" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb82-12"><a href="normal-and-estimating-means.html#cb82-12" tabindex="-1"></a><span class="do">##              Estimate Std. Error z value Pr(&gt;|z|)</span></span>
<span id="cb82-13"><a href="normal-and-estimating-means.html#cb82-13" tabindex="-1"></a><span class="do">## (Intercept)   -1303.9   442563.5  -0.003    0.998</span></span>
<span id="cb82-14"><a href="normal-and-estimating-means.html#cb82-14" tabindex="-1"></a><span class="do">## HoursOfStudy     13.1     4448.4   0.003    0.998</span></span>
<span id="cb82-15"><a href="normal-and-estimating-means.html#cb82-15" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb82-16"><a href="normal-and-estimating-means.html#cb82-16" tabindex="-1"></a><span class="do">## (Dispersion parameter for binomial family taken to be 1)</span></span>
<span id="cb82-17"><a href="normal-and-estimating-means.html#cb82-17" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb82-18"><a href="normal-and-estimating-means.html#cb82-18" tabindex="-1"></a><span class="do">##     Null deviance: 6.8029e+01  on 49  degrees of freedom</span></span>
<span id="cb82-19"><a href="normal-and-estimating-means.html#cb82-19" tabindex="-1"></a><span class="do">## Residual deviance: 1.6529e-08  on 48  degrees of freedom</span></span>
<span id="cb82-20"><a href="normal-and-estimating-means.html#cb82-20" tabindex="-1"></a><span class="do">## AIC: 4</span></span>
<span id="cb82-21"><a href="normal-and-estimating-means.html#cb82-21" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb82-22"><a href="normal-and-estimating-means.html#cb82-22" tabindex="-1"></a><span class="do">## Number of Fisher Scoring iterations: 25</span></span></code></pre></div>
<p>The Bayesian framework performs better.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="normal-and-estimating-means.html#cb83-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb83-2"><a href="normal-and-estimating-means.html#cb83-2" tabindex="-1"></a></span>
<span id="cb83-3"><a href="normal-and-estimating-means.html#cb83-3" tabindex="-1"></a><span class="fu">summary</span>(</span>
<span id="cb83-4"><a href="normal-and-estimating-means.html#cb83-4" tabindex="-1"></a> m.bayes <span class="ot">&lt;-</span> <span class="fu">MCMCglmm</span>(y <span class="sc">~</span> HoursOfStudy, <span class="at">data =</span> study, <span class="at">family =</span> <span class="st">&quot;categorical&quot;</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb83-5"><a href="normal-and-estimating-means.html#cb83-5" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## 
##  Iterations = 3001:12991
##  Thinning interval  = 10
##  Sample size  = 1000 
## 
##  DIC: 2.652789 
## 
##  R-structure:  ~units
## 
##       post.mean l-95% CI u-95% CI eff.samp
## units     9.636 0.008661    44.84    24.55
## 
##  Location effects: y ~ HoursOfStudy 
## 
##              post.mean  l-95% CI  u-95% CI eff.samp  pMCMC    
## (Intercept)  -189.9191 -289.2550  -66.7212    1.966 &lt;0.001 ***
## HoursOfStudy    1.9036    0.6402    2.8894    1.889 &lt;0.001 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Each hour of study is associated with an <span class="math inline">\(\exp (1.9036) \sim 6.7\)</span>-fold increase in the odds of passing. The posterior probability that the association is positive is</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="normal-and-estimating-means.html#cb85-1" tabindex="-1"></a><span class="fu">mean</span>(m.bayes<span class="sc">$</span>Sol[, <span class="dv">2</span>] <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>Let’s try another example.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="normal-and-estimating-means.html#cb87-1" tabindex="-1"></a>chase <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;input/TheChase.txt&quot;</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb87-2"><a href="normal-and-estimating-means.html#cb87-2" tabindex="-1"></a></span>
<span id="cb87-3"><a href="normal-and-estimating-means.html#cb87-3" tabindex="-1"></a><span class="co"># focus on Mark</span></span>
<span id="cb87-4"><a href="normal-and-estimating-means.html#cb87-4" tabindex="-1"></a>mark <span class="ot">&lt;-</span> chase <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Chaser <span class="sc">==</span> <span class="st">&quot;Mark&quot;</span>)</span>
<span id="cb87-5"><a href="normal-and-estimating-means.html#cb87-5" tabindex="-1"></a></span>
<span id="cb87-6"><a href="normal-and-estimating-means.html#cb87-6" tabindex="-1"></a>mark <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> TeamScore, <span class="at">y =</span> Win)) <span class="sc">+</span> <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="dv">0</span>)</span></code></pre></div>
<p><img src="statistics_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
<p>Notice: most scores are between 10 and 25, winning is less common than losing, and winning is more common with higher scores. Fit the following model: <span class="math inline">\(y_i \sim \text{Bin}(1, p_i)\)</span> where <span class="math inline">\(\text{logit}(p_i) = \beta_0 + \beta_1 x_i\)</span> and <span class="math inline">\(x_i\)</span> is the mean score of game <span class="math inline">\(i\)</span>. Assume non-informative normal priors: <span class="math inline">\(\beta_0 \sim N(0, 10^{-8})\)</span> and <span class="math inline">\(\beta_1 \sim N(0, 10^{-8})\)</span>.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="normal-and-estimating-means.html#cb88-1" tabindex="-1"></a><span class="fu">library</span>(rstanarm)</span></code></pre></div>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="normal-and-estimating-means.html#cb89-1" tabindex="-1"></a><span class="co"># This will take ~1 min</span></span>
<span id="cb89-2"><a href="normal-and-estimating-means.html#cb89-2" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(Win <span class="sc">~</span> TeamScore, <span class="at">data =</span> mark, </span>
<span id="cb89-3"><a href="normal-and-estimating-means.html#cb89-3" tabindex="-1"></a>                 <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>), </span>
<span id="cb89-4"><a href="normal-and-estimating-means.html#cb89-4" tabindex="-1"></a>                 <span class="at">prior =</span> <span class="fu">normal</span>(<span class="at">location=</span><span class="dv">0</span>, <span class="at">scale=</span><span class="dv">10</span><span class="sc">^</span><span class="dv">4</span>),</span>
<span id="cb89-5"><a href="normal-and-estimating-means.html#cb89-5" tabindex="-1"></a>                 <span class="at">prior_intercept =</span> <span class="fu">normal</span>(<span class="at">location=</span><span class="dv">0</span>, <span class="at">scale=</span><span class="dv">10</span><span class="sc">^</span><span class="dv">4</span>),</span>
<span id="cb89-6"><a href="normal-and-estimating-means.html#cb89-6" tabindex="-1"></a>                 <span class="at">chains=</span><span class="dv">1</span>, <span class="at">iter=</span> <span class="dv">1500</span>,</span>
<span id="cb89-7"><a href="normal-and-estimating-means.html#cb89-7" tabindex="-1"></a>                 <span class="at">seed =</span> <span class="dv">12345</span>, <span class="at">refresh=</span><span class="dv">0</span>)</span></code></pre></div>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="normal-and-estimating-means.html#cb90-1" tabindex="-1"></a>m1post <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(m1)</span>
<span id="cb90-2"><a href="normal-and-estimating-means.html#cb90-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb90-3"><a href="normal-and-estimating-means.html#cb90-3" tabindex="-1"></a><span class="fu">plot</span>(m1post[,<span class="dv">1</span>],<span class="at">ty=</span><span class="st">&#39;l&#39;</span>,<span class="at">ylab=</span><span class="fu">expression</span>(beta[<span class="dv">0</span>]))</span>
<span id="cb90-4"><a href="normal-and-estimating-means.html#cb90-4" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(m1post[,<span class="dv">1</span>]),<span class="at">xlab=</span><span class="fu">expression</span>(beta[<span class="dv">0</span>]),<span class="at">main=</span><span class="st">&#39;&#39;</span>)</span>
<span id="cb90-5"><a href="normal-and-estimating-means.html#cb90-5" tabindex="-1"></a><span class="fu">plot</span>(m1post[,<span class="dv">2</span>],<span class="at">ty=</span><span class="st">&#39;l&#39;</span>,<span class="at">ylab=</span><span class="fu">expression</span>(beta[<span class="dv">1</span>]))</span>
<span id="cb90-6"><a href="normal-and-estimating-means.html#cb90-6" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(m1post[,<span class="dv">2</span>]),<span class="at">xlab=</span><span class="fu">expression</span>(beta[<span class="dv">1</span>]),<span class="at">main=</span><span class="st">&#39;&#39;</span>)</span></code></pre></div>
<p><img src="statistics_files/figure-html/unnamed-chunk-43-1.png" width="672" /></p>
<p>The traces look converged, and the estimated posterior densities look smooth.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="normal-and-estimating-means.html#cb91-1" tabindex="-1"></a>df.summary <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb91-2"><a href="normal-and-estimating-means.html#cb91-2" tabindex="-1"></a><span class="at">p.means =</span> <span class="fu">round</span>(<span class="fu">apply</span>(m1post,<span class="dv">2</span>,mean),<span class="dv">4</span>),</span>
<span id="cb91-3"><a href="normal-and-estimating-means.html#cb91-3" tabindex="-1"></a><span class="at">p.ci.lo =</span> <span class="fu">round</span>(<span class="fu">apply</span>(m1post,<span class="dv">2</span>,quantile,.<span class="dv">025</span>),<span class="dv">4</span>),</span>
<span id="cb91-4"><a href="normal-and-estimating-means.html#cb91-4" tabindex="-1"></a><span class="at">p.ci.hi =</span> <span class="fu">round</span>(<span class="fu">apply</span>(m1post,<span class="dv">2</span>,quantile,.<span class="dv">975</span>),<span class="dv">4</span>))</span>
<span id="cb91-5"><a href="normal-and-estimating-means.html#cb91-5" tabindex="-1"></a></span>
<span id="cb91-6"><a href="normal-and-estimating-means.html#cb91-6" tabindex="-1"></a><span class="fu">print</span>(df.summary)</span></code></pre></div>
<pre><code>##             p.means  p.ci.lo p.ci.hi
## (Intercept) -8.8993 -11.5397 -6.4686
## TeamScore    0.4179   0.2939  0.5477</code></pre>
<p>There is a positive correlation between the Team Score and the odds of winning. Calculate the posterior probability.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="normal-and-estimating-means.html#cb93-1" tabindex="-1"></a><span class="fu">mean</span>(m1post[, <span class="dv">2</span>] <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>Compare this to the classical result. They are pretty close.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="normal-and-estimating-means.html#cb95-1" tabindex="-1"></a><span class="fu">summary</span>(</span>
<span id="cb95-2"><a href="normal-and-estimating-means.html#cb95-2" tabindex="-1"></a>  m1c <span class="ot">&lt;-</span> <span class="fu">glm</span>(Win <span class="sc">~</span> TeamScore, <span class="at">data =</span> mark, <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb95-3"><a href="normal-and-estimating-means.html#cb95-3" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = Win ~ TeamScore, family = &quot;binomial&quot;, data = mark)
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -8.99425    1.28162  -7.018 2.25e-12 ***
## TeamScore    0.42199    0.06615   6.379 1.78e-10 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 261.45  on 245  degrees of freedom
## Residual deviance: 195.35  on 244  degrees of freedom
## AIC: 199.35
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<p>Let’s also plot the estimated model on a grid of possible Team Score values. Recall <span class="math inline">\(p = \frac{1}{1 + e^{-z}}\)</span>,</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="normal-and-estimating-means.html#cb97-1" tabindex="-1"></a><span class="co"># setting a grid of values</span></span>
<span id="cb97-2"><a href="normal-and-estimating-means.html#cb97-2" tabindex="-1"></a>TeamScoreGrid <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">30</span>)</span>
<span id="cb97-3"><a href="normal-and-estimating-means.html#cb97-3" tabindex="-1"></a></span>
<span id="cb97-4"><a href="normal-and-estimating-means.html#cb97-4" tabindex="-1"></a><span class="co"># using posterior samples of beta0 and beta1</span></span>
<span id="cb97-5"><a href="normal-and-estimating-means.html#cb97-5" tabindex="-1"></a><span class="co"># to produce a posterior sample of probabilities at each value of TeamScoreGrid</span></span>
<span id="cb97-6"><a href="normal-and-estimating-means.html#cb97-6" tabindex="-1"></a></span>
<span id="cb97-7"><a href="normal-and-estimating-means.html#cb97-7" tabindex="-1"></a>p.eval <span class="ot">&lt;-</span> <span class="cf">function</span>(Score,b0,b1){<span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="sc">-</span>(b0<span class="sc">+</span>b1<span class="sc">*</span>Score)))}</span>
<span id="cb97-8"><a href="normal-and-estimating-means.html#cb97-8" tabindex="-1"></a></span>
<span id="cb97-9"><a href="normal-and-estimating-means.html#cb97-9" tabindex="-1"></a>p.sample <span class="ot">&lt;-</span> <span class="fu">sapply</span>(TeamScoreGrid,p.eval,<span class="at">b0=</span>m1post[,<span class="dv">1</span>],<span class="at">b1=</span>m1post[,<span class="dv">2</span>])</span>
<span id="cb97-10"><a href="normal-and-estimating-means.html#cb97-10" tabindex="-1"></a></span>
<span id="cb97-11"><a href="normal-and-estimating-means.html#cb97-11" tabindex="-1"></a><span class="co"># evaluating posterior mean probability for each score:</span></span>
<span id="cb97-12"><a href="normal-and-estimating-means.html#cb97-12" tabindex="-1"></a>p.post.mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(p.sample,<span class="dv">2</span>,mean)</span>
<span id="cb97-13"><a href="normal-and-estimating-means.html#cb97-13" tabindex="-1"></a></span>
<span id="cb97-14"><a href="normal-and-estimating-means.html#cb97-14" tabindex="-1"></a><span class="co"># evaluating 95% CI for the probability for each score:</span></span>
<span id="cb97-15"><a href="normal-and-estimating-means.html#cb97-15" tabindex="-1"></a>p.post.lo <span class="ot">&lt;-</span> <span class="fu">apply</span>(p.sample,<span class="dv">2</span>,quantile,.<span class="dv">025</span>)</span>
<span id="cb97-16"><a href="normal-and-estimating-means.html#cb97-16" tabindex="-1"></a>p.post.hi <span class="ot">&lt;-</span> <span class="fu">apply</span>(p.sample,<span class="dv">2</span>,quantile,.<span class="dv">975</span>)</span>
<span id="cb97-17"><a href="normal-and-estimating-means.html#cb97-17" tabindex="-1"></a></span>
<span id="cb97-18"><a href="normal-and-estimating-means.html#cb97-18" tabindex="-1"></a>data.post <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">TeamScore=</span>TeamScoreGrid, <span class="at">p.mn=</span>p.post.mean,</span>
<span id="cb97-19"><a href="normal-and-estimating-means.html#cb97-19" tabindex="-1"></a>                        <span class="at">p.lo=</span>p.post.lo, <span class="at">p.hi=</span>p.post.hi)</span>
<span id="cb97-20"><a href="normal-and-estimating-means.html#cb97-20" tabindex="-1"></a></span>
<span id="cb97-21"><a href="normal-and-estimating-means.html#cb97-21" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>mark,<span class="fu">aes</span>(<span class="at">x=</span>TeamScore,<span class="at">y=</span><span class="fu">jitter</span>(Win)))<span class="sc">+</span></span>
<span id="cb97-22"><a href="normal-and-estimating-means.html#cb97-22" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb97-23"><a href="normal-and-estimating-means.html#cb97-23" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data=</span>data.post,<span class="fu">aes</span>(<span class="at">x=</span>TeamScore,<span class="at">y=</span>p.mn,<span class="at">ymin=</span>p.lo,<span class="at">ymax=</span>p.hi),<span class="at">alpha=</span>.<span class="dv">5</span>,<span class="at">fill=</span><span class="st">&#39;salmon&#39;</span>) <span class="sc">+</span></span>
<span id="cb97-24"><a href="normal-and-estimating-means.html#cb97-24" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>data.post,<span class="fu">aes</span>(<span class="at">x=</span>TeamScore,<span class="at">y=</span>p.mn),<span class="at">col=</span><span class="st">&#39;red&#39;</span>, <span class="at">linewidth=</span><span class="fl">1.5</span>)<span class="sc">+</span></span>
<span id="cb97-25"><a href="normal-and-estimating-means.html#cb97-25" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;Outcome&#39;</span>)<span class="sc">+</span></span>
<span id="cb97-26"><a href="normal-and-estimating-means.html#cb97-26" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">name=</span><span class="st">&#39;&#39;</span>, <span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&#39;Lose&#39;</span>,<span class="st">&#39;Win&#39;</span>),</span>
<span id="cb97-27"><a href="normal-and-estimating-means.html#cb97-27" tabindex="-1"></a>                     <span class="at">sec.axis=</span><span class="fu">sec_axis</span>(<span class="sc">~</span>., <span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,.<span class="dv">2</span>),</span>
<span id="cb97-28"><a href="normal-and-estimating-means.html#cb97-28" tabindex="-1"></a>                                       <span class="at">name=</span><span class="st">&#39;Probability of Winning&#39;</span>))<span class="sc">+</span></span>
<span id="cb97-29"><a href="normal-and-estimating-means.html#cb97-29" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">30</span>))</span></code></pre></div>
<pre><code>## Warning: Removed 1 row containing missing values (`geom_line()`).</code></pre>
<p><img src="statistics_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="normal-and-estimating-means.html#cb99-1" tabindex="-1"></a>data.post<span class="sc">$</span>TeamScore[<span class="fu">which</span>(data.post<span class="sc">$</span>ppp <span class="sc">&gt;=</span> .<span class="dv">80</span>)][<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>What is the posterior probability that a team score of 25 beats Mark?</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="normal-and-estimating-means.html#cb101-1" tabindex="-1"></a><span class="fu">p.eval</span>(<span class="at">Score =</span> <span class="dv">25</span>, <span class="at">b0 =</span> m1post[,<span class="dv">1</span>], <span class="at">b1 =</span> m1post[,<span class="dv">2</span>]) <span class="sc">%&gt;%</span> <span class="fu">mean</span>()</span></code></pre></div>
<pre><code>## [1] 0.816335</code></pre>
<p>What score do you need in order to win with 80% certainty, <span class="math inline">\(P(y = 1|x) \ge .8)\)</span>. For each <span class="math inline">\(x\)</span> on a grid, take the posterior sample for <span class="math inline">\(p\)</span> and generate <span class="math inline">\(y = \text{Bern}(p)\)</span>. Then get <span class="math inline">\(prob(y == 1)\)</span>.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="normal-and-estimating-means.html#cb103-1" tabindex="-1"></a><span class="co"># simulating the game outcomes (y)</span></span>
<span id="cb103-2"><a href="normal-and-estimating-means.html#cb103-2" tabindex="-1"></a>y.sample <span class="ot">&lt;-</span> (<span class="fu">array</span>(<span class="fu">runif</span>(<span class="fu">prod</span>(<span class="fu">dim</span>(p.sample))),<span class="at">dim=</span><span class="fu">dim</span>(p.sample)) <span class="sc">&lt;</span> p.sample)<span class="sc">*</span><span class="dv">1</span></span>
<span id="cb103-3"><a href="normal-and-estimating-means.html#cb103-3" tabindex="-1"></a></span>
<span id="cb103-4"><a href="normal-and-estimating-means.html#cb103-4" tabindex="-1"></a><span class="co"># posterior predictive probabilities that y=1</span></span>
<span id="cb103-5"><a href="normal-and-estimating-means.html#cb103-5" tabindex="-1"></a>data.post<span class="sc">$</span>ppp <span class="ot">&lt;-</span> <span class="fu">apply</span>(y.sample,<span class="dv">2</span>,mean)</span>
<span id="cb103-6"><a href="normal-and-estimating-means.html#cb103-6" tabindex="-1"></a></span>
<span id="cb103-7"><a href="normal-and-estimating-means.html#cb103-7" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>data.post,<span class="fu">aes</span>(<span class="at">x=</span>TeamScore,<span class="at">y=</span>ppp))<span class="sc">+</span></span>
<span id="cb103-8"><a href="normal-and-estimating-means.html#cb103-8" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">col=</span><span class="st">&#39;red&#39;</span>,<span class="at">size=</span><span class="fl">1.5</span>)<span class="sc">+</span></span>
<span id="cb103-9"><a href="normal-and-estimating-means.html#cb103-9" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept=</span><span class="fl">0.80</span>),<span class="at">col=</span><span class="st">&#39;blue&#39;</span>,<span class="at">size=</span><span class="fl">1.2</span>,<span class="at">lty=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb103-10"><a href="normal-and-estimating-means.html#cb103-10" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept=</span><span class="dv">24</span>),<span class="at">col=</span><span class="st">&#39;brown&#39;</span>,<span class="at">size=</span><span class="fl">1.1</span>,<span class="at">lty=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb103-11"><a href="normal-and-estimating-means.html#cb103-11" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept=</span><span class="dv">25</span>),<span class="at">col=</span><span class="st">&#39;brown&#39;</span>,<span class="at">size=</span><span class="fl">1.1</span>,<span class="at">lty=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb103-12"><a href="normal-and-estimating-means.html#cb103-12" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;Post. Pred. Prob. of Winning&#39;</span>)<span class="sc">+</span></span>
<span id="cb103-13"><a href="normal-and-estimating-means.html#cb103-13" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">30</span>))<span class="sc">+</span><span class="fu">theme_gray</span>(<span class="at">base_size=</span><span class="dv">18</span>)</span></code></pre></div>
<pre><code>## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
## ℹ Please use `linewidth` instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
## generated.</code></pre>
<pre><code>## Warning: Removed 1 row containing missing values (`geom_line()`).</code></pre>
<p><img src="statistics_files/figure-html/unnamed-chunk-49-1.png" width="672" /></p>
</div>
<div id="missing-data" class="section level3 hasAnchor" number="3.5.4">
<h3><span class="header-section-number">3.5.4</span> Missing Data<a href="normal-and-estimating-means.html#missing-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Consider a situation where 20 customers are surveyed to measure satisfaction. You can model this as <span class="math inline">\(x_i | p \sim \text{Bin}(1, p)\)</span> where <span class="math inline">\(p\)</span> is the probability of satisfaction. The conjugate prior for <span class="math inline">\(p\)</span> is <span class="math inline">\(p \sim \text{Beta}(a, b)\)</span>. However, some observations are missing. You can divide the respondents into <span class="math inline">\(x_{obs}\)</span> and <span class="math inline">\(x_{miss}\)</span>. Then</p>
<p><span class="math display">\[
f(x|p) = \prod_i f(x_i|p) = f(x_{obs}|p) f(x_{miss}|p)
\]</span></p>
<p>When missingness is random, you can smiply discard missing observations. So if there were 4 missing responses, and 10 of the 16 completed surveys were satisfied, <span class="math inline">\(p|x_{obs} \sim \text{Beta}(1 + 10, 1 + 6)\)</span>. The Beta-bimomial conjugate model is</p>
<p><span class="math display">\[
\begin{align}
x_i &amp; \sim \text{Bin}(1, p) \\
p &amp; \sim \text{Beta}(a, b)
\end{align}
\]</span></p>
<p>with posterior <span class="math inline">\(p | x \sim \text{Beta} \left( a + \sum_i x_i, b + \sum_i (1 - x_i) \right)\)</span></p>
<p>But if the data are not missing at random, you need to model the probability of participating. From past experience you might infer that participation rates are 30% for satisfied and 90% for dissatisfied.</p>
<p><span class="math display">\[
\begin{align}
P(z_i = 1 | x_i = 1) &amp;= .3 \\
P(z_i = 1 | x_i = 0) &amp;= .9
\end{align}
\]</span></p>
<p>Combining them, you have <span class="math inline">\(P(x_i = 1 | z_i = 0, p) = \frac{7p}{6p + 1}\)</span>. Set up a Gibbs sampler. Step 0: assign random prior values to the missing <span class="math inline">\(x\)</span>. Step 1: given <span class="math inline">\(x\)</span>, sample <span class="math inline">\(p\)</span> from <span class="math inline">\(\text{Beta}(a + \sum_i x_i, b + \sum_i (1 - x_i))\)</span>. Step 2: given <span class="math inline">\(p\)</span>, assign the missing <span class="math inline">\(x\)</span> to 1 with probability <span class="math inline">\(p|x_{obs} \sim \text{Beta}(1 + 10, 1 + 6)\)</span>.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="normal-and-estimating-means.html#cb106-1" tabindex="-1"></a><span class="co"># prior parameters</span></span>
<span id="cb106-2"><a href="normal-and-estimating-means.html#cb106-2" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">1</span>; b <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb106-3"><a href="normal-and-estimating-means.html#cb106-3" tabindex="-1"></a><span class="co"># data</span></span>
<span id="cb106-4"><a href="normal-and-estimating-means.html#cb106-4" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="cn">NA</span>),<span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">6</span>,<span class="dv">4</span>))</span>
<span id="cb106-5"><a href="normal-and-estimating-means.html#cb106-5" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">0</span>,<span class="fu">c</span>(<span class="dv">16</span>,<span class="dv">4</span>))</span>
<span id="cb106-6"><a href="normal-and-estimating-means.html#cb106-6" tabindex="-1"></a></span>
<span id="cb106-7"><a href="normal-and-estimating-means.html#cb106-7" tabindex="-1"></a><span class="co"># initial values.</span></span>
<span id="cb106-8"><a href="normal-and-estimating-means.html#cb106-8" tabindex="-1"></a>x.sample <span class="ot">&lt;-</span> x; x.sample[<span class="fu">is.na</span>(x)] <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>,<span class="at">size=</span><span class="dv">4</span>,<span class="at">replace=</span>T)</span>
<span id="cb106-9"><a href="normal-and-estimating-means.html#cb106-9" tabindex="-1"></a></span>
<span id="cb106-10"><a href="normal-and-estimating-means.html#cb106-10" tabindex="-1"></a><span class="co"># number of iterations</span></span>
<span id="cb106-11"><a href="normal-and-estimating-means.html#cb106-11" tabindex="-1"></a>ITER <span class="ot">&lt;-</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">4</span><span class="sc">+</span><span class="dv">500</span></span>
<span id="cb106-12"><a href="normal-and-estimating-means.html#cb106-12" tabindex="-1"></a><span class="co"># and the monitor for recording the iterations of p</span></span>
<span id="cb106-13"><a href="normal-and-estimating-means.html#cb106-13" tabindex="-1"></a>mon.p <span class="ot">&lt;-</span> <span class="fu">numeric</span>(ITER)</span>
<span id="cb106-14"><a href="normal-and-estimating-means.html#cb106-14" tabindex="-1"></a><span class="co"># ... and one of the missing observations</span></span>
<span id="cb106-15"><a href="normal-and-estimating-means.html#cb106-15" tabindex="-1"></a>mon.x20 <span class="ot">&lt;-</span> <span class="fu">numeric</span>(ITER)</span>
<span id="cb106-16"><a href="normal-and-estimating-means.html#cb106-16" tabindex="-1"></a></span>
<span id="cb106-17"><a href="normal-and-estimating-means.html#cb106-17" tabindex="-1"></a><span class="co"># Gibbs sampler:</span></span>
<span id="cb106-18"><a href="normal-and-estimating-means.html#cb106-18" tabindex="-1"></a></span>
<span id="cb106-19"><a href="normal-and-estimating-means.html#cb106-19" tabindex="-1"></a><span class="cf">for</span>(iter <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>ITER){</span>
<span id="cb106-20"><a href="normal-and-estimating-means.html#cb106-20" tabindex="-1"></a>  <span class="co"># sampling p</span></span>
<span id="cb106-21"><a href="normal-and-estimating-means.html#cb106-21" tabindex="-1"></a>  mon.p[iter] <span class="ot">&lt;-</span> p <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(<span class="dv">1</span>,a<span class="sc">+</span><span class="fu">sum</span>(x.sample),b<span class="sc">+</span><span class="fu">sum</span>(<span class="dv">1</span><span class="sc">-</span>x.sample))</span>
<span id="cb106-22"><a href="normal-and-estimating-means.html#cb106-22" tabindex="-1"></a>  <span class="co"># sampling (missing x)</span></span>
<span id="cb106-23"><a href="normal-and-estimating-means.html#cb106-23" tabindex="-1"></a>  x.sample[<span class="fu">is.na</span>(x)] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(x)),<span class="dv">1</span>,<span class="dv">7</span><span class="sc">*</span>p<span class="sc">/</span>(<span class="dv">6</span><span class="sc">*</span>p<span class="sc">+</span><span class="dv">1</span>))</span>
<span id="cb106-24"><a href="normal-and-estimating-means.html#cb106-24" tabindex="-1"></a>    mon.x20[iter] <span class="ot">&lt;-</span> x.sample[<span class="dv">20</span>]</span>
<span id="cb106-25"><a href="normal-and-estimating-means.html#cb106-25" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="normal-and-estimating-means.html#cb107-1" tabindex="-1"></a><span class="co"># prior parameters</span></span>
<span id="cb107-2"><a href="normal-and-estimating-means.html#cb107-2" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">1</span>; b <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb107-3"><a href="normal-and-estimating-means.html#cb107-3" tabindex="-1"></a><span class="co"># data: 40 satisfied, 10 not satisfied, 50 no-responses</span></span>
<span id="cb107-4"><a href="normal-and-estimating-means.html#cb107-4" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="cn">NA</span>),<span class="fu">c</span>(<span class="dv">40</span>,<span class="dv">10</span>,<span class="dv">50</span>))</span>
<span id="cb107-5"><a href="normal-and-estimating-means.html#cb107-5" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">0</span>,<span class="fu">c</span>(<span class="dv">50</span>,<span class="dv">50</span>))</span>
<span id="cb107-6"><a href="normal-and-estimating-means.html#cb107-6" tabindex="-1"></a><span class="co"># what if all 50 were satisfied?</span></span>
<span id="cb107-7"><a href="normal-and-estimating-means.html#cb107-7" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>),<span class="fu">c</span>(<span class="dv">40</span>,<span class="dv">10</span>,<span class="dv">50</span>))</span>
<span id="cb107-8"><a href="normal-and-estimating-means.html#cb107-8" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">0</span>,<span class="fu">c</span>(<span class="dv">50</span>,<span class="dv">50</span>))</span>
<span id="cb107-9"><a href="normal-and-estimating-means.html#cb107-9" tabindex="-1"></a><span class="co"># what if all 50 were like the other 50?</span></span>
<span id="cb107-10"><a href="normal-and-estimating-means.html#cb107-10" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>),<span class="fu">c</span>(<span class="dv">40</span>,<span class="dv">10</span>,<span class="dv">40</span>,<span class="dv">10</span>))</span>
<span id="cb107-11"><a href="normal-and-estimating-means.html#cb107-11" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">0</span>,<span class="fu">c</span>(<span class="dv">50</span>,<span class="dv">50</span>))</span>
<span id="cb107-12"><a href="normal-and-estimating-means.html#cb107-12" tabindex="-1"></a></span>
<span id="cb107-13"><a href="normal-and-estimating-means.html#cb107-13" tabindex="-1"></a><span class="co"># initial values.</span></span>
<span id="cb107-14"><a href="normal-and-estimating-means.html#cb107-14" tabindex="-1"></a>x.sample <span class="ot">&lt;-</span> x; x.sample[<span class="fu">is.na</span>(x)] <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>,<span class="at">size=</span><span class="dv">50</span>,<span class="at">replace=</span>T)</span>
<span id="cb107-15"><a href="normal-and-estimating-means.html#cb107-15" tabindex="-1"></a></span>
<span id="cb107-16"><a href="normal-and-estimating-means.html#cb107-16" tabindex="-1"></a><span class="co"># number of iterations</span></span>
<span id="cb107-17"><a href="normal-and-estimating-means.html#cb107-17" tabindex="-1"></a>ITER <span class="ot">&lt;-</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">4</span><span class="sc">+</span><span class="dv">500</span></span>
<span id="cb107-18"><a href="normal-and-estimating-means.html#cb107-18" tabindex="-1"></a><span class="co"># and the monitor for recording the iterations of p</span></span>
<span id="cb107-19"><a href="normal-and-estimating-means.html#cb107-19" tabindex="-1"></a>mon.p <span class="ot">&lt;-</span> <span class="fu">numeric</span>(ITER)</span>
<span id="cb107-20"><a href="normal-and-estimating-means.html#cb107-20" tabindex="-1"></a><span class="co"># ... and one of the missing observations</span></span>
<span id="cb107-21"><a href="normal-and-estimating-means.html#cb107-21" tabindex="-1"></a>mon.x20 <span class="ot">&lt;-</span> <span class="fu">numeric</span>(ITER)</span>
<span id="cb107-22"><a href="normal-and-estimating-means.html#cb107-22" tabindex="-1"></a></span>
<span id="cb107-23"><a href="normal-and-estimating-means.html#cb107-23" tabindex="-1"></a><span class="co"># Gibbs sampler:</span></span>
<span id="cb107-24"><a href="normal-and-estimating-means.html#cb107-24" tabindex="-1"></a></span>
<span id="cb107-25"><a href="normal-and-estimating-means.html#cb107-25" tabindex="-1"></a><span class="cf">for</span>(iter <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>ITER){</span>
<span id="cb107-26"><a href="normal-and-estimating-means.html#cb107-26" tabindex="-1"></a>  <span class="co"># sampling p</span></span>
<span id="cb107-27"><a href="normal-and-estimating-means.html#cb107-27" tabindex="-1"></a>  mon.p[iter] <span class="ot">&lt;-</span> p <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(<span class="dv">1</span>,a<span class="sc">+</span><span class="fu">sum</span>(x.sample),b<span class="sc">+</span><span class="fu">sum</span>(<span class="dv">1</span><span class="sc">-</span>x.sample))</span>
<span id="cb107-28"><a href="normal-and-estimating-means.html#cb107-28" tabindex="-1"></a>  <span class="co"># sampling (missing x)</span></span>
<span id="cb107-29"><a href="normal-and-estimating-means.html#cb107-29" tabindex="-1"></a>  x.sample[<span class="fu">is.na</span>(x)] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(x)),<span class="dv">1</span>,<span class="dv">7</span><span class="sc">*</span>p<span class="sc">/</span>(<span class="dv">6</span><span class="sc">*</span>p<span class="sc">+</span><span class="dv">1</span>))</span>
<span id="cb107-30"><a href="normal-and-estimating-means.html#cb107-30" tabindex="-1"></a>    mon.x20[iter] <span class="ot">&lt;-</span> x.sample[<span class="dv">20</span>]</span>
<span id="cb107-31"><a href="normal-and-estimating-means.html#cb107-31" tabindex="-1"></a>}</span>
<span id="cb107-32"><a href="normal-and-estimating-means.html#cb107-32" tabindex="-1"></a></span>
<span id="cb107-33"><a href="normal-and-estimating-means.html#cb107-33" tabindex="-1"></a><span class="co"># Posterior mean probability of being satisfied.</span></span>
<span id="cb107-34"><a href="normal-and-estimating-means.html#cb107-34" tabindex="-1"></a><span class="fu">mean</span>(mon.p[<span class="dv">501</span><span class="sc">:</span><span class="dv">10500</span>])</span></code></pre></div>
<pre><code>## [1] 0.7947594</code></pre>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="normal-and-estimating-means.html#cb109-1" tabindex="-1"></a><span class="co"># 95% CI</span></span>
<span id="cb109-2"><a href="normal-and-estimating-means.html#cb109-2" tabindex="-1"></a><span class="fu">quantile</span>(mon.p[<span class="dv">501</span><span class="sc">:</span><span class="dv">10500</span>], <span class="fu">c</span>(.<span class="dv">025</span>, .<span class="dv">975</span>))</span></code></pre></div>
<pre><code>##      2.5%     97.5% 
## 0.7122337 0.8661632</code></pre>
</div>
<div id="change-point-regression" class="section level3 hasAnchor" number="3.5.5">
<h3><span class="header-section-number">3.5.5</span> Change Point Regression<a href="normal-and-estimating-means.html#change-point-regression" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s try another example. The <code>Nile</code> data set contains Nile flow by year. We want to ask whether the trend changed after 1897. Compare an intercept-only model, <span class="math inline">\(y_t \sim N(\mu_t, \tau)\)</span> where <span class="math inline">\(\mu_t = \alpha\)</span> is a constant, to a linear time trend model where <span class="math inline">\(\mu_t = \alpha + \beta \text{Year}\)</span>. Use conjugate non-informative priors, <span class="math inline">\(\alpha \sim N(0, 10^{-10})\)</span> and <span class="math inline">\(\tau \sim \text{Gamma}(.01, .01)\)</span>.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="normal-and-estimating-means.html#cb111-1" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Nile&quot;</span>)</span>
<span id="cb111-2"><a href="normal-and-estimating-means.html#cb111-2" tabindex="-1"></a></span>
<span id="cb111-3"><a href="normal-and-estimating-means.html#cb111-3" tabindex="-1"></a>my_nile <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">year =</span> <span class="fu">time</span>(Nile), <span class="at">flow =</span> Nile, <span class="at">after =</span> <span class="fu">as.numeric</span>(year<span class="sc">&gt;</span><span class="dv">1897</span>))</span>
<span id="cb111-4"><a href="normal-and-estimating-means.html#cb111-4" tabindex="-1"></a></span>
<span id="cb111-5"><a href="normal-and-estimating-means.html#cb111-5" tabindex="-1"></a><span class="co"># intercept-only</span></span>
<span id="cb111-6"><a href="normal-and-estimating-means.html#cb111-6" tabindex="-1"></a>m0 <span class="ot">&lt;-</span> <span class="fu">MCMCglmm</span>(flow <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> my_nile, </span>
<span id="cb111-7"><a href="normal-and-estimating-means.html#cb111-7" tabindex="-1"></a>               <span class="at">nitt =</span> <span class="dv">1500</span>, <span class="at">burnin =</span> <span class="dv">500</span>, <span class="at">thin =</span> <span class="dv">1</span>,</span>
<span id="cb111-8"><a href="normal-and-estimating-means.html#cb111-8" tabindex="-1"></a>               <span class="at">prior =</span> <span class="fu">list</span>(<span class="at">B =</span> <span class="fu">list</span>(<span class="at">mu =</span> <span class="dv">0</span>, <span class="at">V =</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">10</span>)),</span>
<span id="cb111-9"><a href="normal-and-estimating-means.html#cb111-9" tabindex="-1"></a>               <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb111-10"><a href="normal-and-estimating-means.html#cb111-10" tabindex="-1"></a><span class="do">## Warning: Unknown or uninitialised column: `family`.</span></span>
<span id="cb111-11"><a href="normal-and-estimating-means.html#cb111-11" tabindex="-1"></a></span>
<span id="cb111-12"><a href="normal-and-estimating-means.html#cb111-12" tabindex="-1"></a><span class="co"># Trend</span></span>
<span id="cb111-13"><a href="normal-and-estimating-means.html#cb111-13" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">MCMCglmm</span>(flow <span class="sc">~</span> year, <span class="at">data =</span> my_nile, </span>
<span id="cb111-14"><a href="normal-and-estimating-means.html#cb111-14" tabindex="-1"></a>               <span class="at">nitt =</span> <span class="dv">1500</span>, <span class="at">burnin =</span> <span class="dv">500</span>, <span class="at">thin =</span> <span class="dv">1</span>,</span>
<span id="cb111-15"><a href="normal-and-estimating-means.html#cb111-15" tabindex="-1"></a>               <span class="at">prior =</span> <span class="fu">list</span>(<span class="at">B =</span> <span class="fu">list</span>(<span class="at">mu =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">V =</span> <span class="fu">diag</span>(<span class="dv">2</span>)<span class="sc">*</span><span class="dv">10</span><span class="sc">^</span><span class="dv">10</span>)),</span>
<span id="cb111-16"><a href="normal-and-estimating-means.html#cb111-16" tabindex="-1"></a>               <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb111-17"><a href="normal-and-estimating-means.html#cb111-17" tabindex="-1"></a><span class="do">## Warning: Unknown or uninitialised column: `family`.</span></span>
<span id="cb111-18"><a href="normal-and-estimating-means.html#cb111-18" tabindex="-1"></a></span>
<span id="cb111-19"><a href="normal-and-estimating-means.html#cb111-19" tabindex="-1"></a><span class="co"># flow has been decreasing by 2.7 per year (95% CI, 1.6 - 3.7)</span></span>
<span id="cb111-20"><a href="normal-and-estimating-means.html#cb111-20" tabindex="-1"></a><span class="fu">summary</span>(m1)<span class="sc">$</span>solutions</span>
<span id="cb111-21"><a href="normal-and-estimating-means.html#cb111-21" tabindex="-1"></a><span class="do">##               post.mean    l-95% CI    u-95% CI eff.samp pMCMC</span></span>
<span id="cb111-22"><a href="normal-and-estimating-means.html#cb111-22" tabindex="-1"></a><span class="do">## (Intercept) 6180.699732 4183.400324 8268.137317     1000 0.001</span></span>
<span id="cb111-23"><a href="normal-and-estimating-means.html#cb111-23" tabindex="-1"></a><span class="do">## year          -2.739952   -3.865672   -1.741701     1000 0.001</span></span>
<span id="cb111-24"><a href="normal-and-estimating-means.html#cb111-24" tabindex="-1"></a></span>
<span id="cb111-25"><a href="normal-and-estimating-means.html#cb111-25" tabindex="-1"></a><span class="co"># posterior probability of negative trend</span></span>
<span id="cb111-26"><a href="normal-and-estimating-means.html#cb111-26" tabindex="-1"></a><span class="fu">mean</span>(m1<span class="sc">$</span>Sol[, <span class="dv">2</span>] <span class="sc">&lt;</span> <span class="dv">0</span>)</span>
<span id="cb111-27"><a href="normal-and-estimating-means.html#cb111-27" tabindex="-1"></a><span class="do">## [1] 1</span></span>
<span id="cb111-28"><a href="normal-and-estimating-means.html#cb111-28" tabindex="-1"></a></span>
<span id="cb111-29"><a href="normal-and-estimating-means.html#cb111-29" tabindex="-1"></a><span class="co"># Change Point</span></span>
<span id="cb111-30"><a href="normal-and-estimating-means.html#cb111-30" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">MCMCglmm</span>(flow <span class="sc">~</span> after, <span class="at">data =</span> my_nile, </span>
<span id="cb111-31"><a href="normal-and-estimating-means.html#cb111-31" tabindex="-1"></a>               <span class="at">nitt =</span> <span class="dv">1500</span>, <span class="at">burnin =</span> <span class="dv">500</span>, <span class="at">thin =</span> <span class="dv">1</span>,</span>
<span id="cb111-32"><a href="normal-and-estimating-means.html#cb111-32" tabindex="-1"></a>               <span class="at">prior =</span> <span class="fu">list</span>(<span class="at">B =</span> <span class="fu">list</span>(<span class="at">mu =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">V =</span> <span class="fu">diag</span>(<span class="dv">2</span>)<span class="sc">*</span><span class="dv">10</span><span class="sc">^</span><span class="dv">10</span>)),</span>
<span id="cb111-33"><a href="normal-and-estimating-means.html#cb111-33" tabindex="-1"></a>               <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb111-34"><a href="normal-and-estimating-means.html#cb111-34" tabindex="-1"></a><span class="do">## Warning: Unknown or uninitialised column: `family`.</span></span>
<span id="cb111-35"><a href="normal-and-estimating-means.html#cb111-35" tabindex="-1"></a></span>
<span id="cb111-36"><a href="normal-and-estimating-means.html#cb111-36" tabindex="-1"></a><span class="co"># Flow fell 244 from 1098.</span></span>
<span id="cb111-37"><a href="normal-and-estimating-means.html#cb111-37" tabindex="-1"></a><span class="fu">summary</span>(m2)<span class="sc">$</span>solutions</span>
<span id="cb111-38"><a href="normal-and-estimating-means.html#cb111-38" tabindex="-1"></a><span class="do">##             post.mean  l-95% CI  u-95% CI eff.samp pMCMC</span></span>
<span id="cb111-39"><a href="normal-and-estimating-means.html#cb111-39" tabindex="-1"></a><span class="do">## (Intercept) 1097.3780 1048.3385 1143.4094     1000 0.001</span></span>
<span id="cb111-40"><a href="normal-and-estimating-means.html#cb111-40" tabindex="-1"></a><span class="do">## after       -243.8701 -300.7758 -193.1304     1000 0.001</span></span>
<span id="cb111-41"><a href="normal-and-estimating-means.html#cb111-41" tabindex="-1"></a></span>
<span id="cb111-42"><a href="normal-and-estimating-means.html#cb111-42" tabindex="-1"></a><span class="co"># Compare the DIC. m2 has smallest DIC.</span></span>
<span id="cb111-43"><a href="normal-and-estimating-means.html#cb111-43" tabindex="-1"></a>m0<span class="sc">$</span>DIC</span>
<span id="cb111-44"><a href="normal-and-estimating-means.html#cb111-44" tabindex="-1"></a><span class="do">## [1] 1313.057</span></span>
<span id="cb111-45"><a href="normal-and-estimating-means.html#cb111-45" tabindex="-1"></a>m1<span class="sc">$</span>DIC</span>
<span id="cb111-46"><a href="normal-and-estimating-means.html#cb111-46" tabindex="-1"></a><span class="do">## [1] 1290.783</span></span>
<span id="cb111-47"><a href="normal-and-estimating-means.html#cb111-47" tabindex="-1"></a>m2<span class="sc">$</span>DIC</span>
<span id="cb111-48"><a href="normal-and-estimating-means.html#cb111-48" tabindex="-1"></a><span class="do">## [1] 1261.396</span></span></code></pre></div>
<p>This isn’t quite how you would want to do it, however. Instead, you’d like to determine which year the change point occurred. Define <span class="math inline">\(\mu_t = \alpha_0\)</span> for <span class="math inline">\(t&lt;t^*\)</span>, and <span class="math inline">\(\alpha_1\)</span> for <span class="math inline">\(t \ge t^*\)</span>. Use conjugate non-informative priors for both, <span class="math inline">\(\alpha_0 = \alpha_1 \sim N(0, 10^{-8})\)</span> and <span class="math inline">\(\tau \sim \text{Gamma}(.01, .01)\)</span> and a uniform prior for <span class="math inline">\(t^* \sim U(1871.5, 1969.5\)</span>.</p>
<p>The posterior conditional distributions for <span class="math inline">\(\alpha_0\)</span> and <span class="math inline">\(\alpha_1\)</span> are from Eqns <a href="normal-and-estimating-means.html#eq:mu-posterior">(3.2)</a>.</p>
<p><span class="math display">\[
\begin{align}
\alpha_0 | y,t^*,\tau &amp; \sim N \left( \frac{\sum_{t&lt;t^*} y_t \tau}{\sum_{t&lt;t^*} 1 \tau + 10^{-8}}, \sum_{t&lt;t^*} 1 \tau + 10^{-8} \right) \\
\alpha_1 | y,t^*,\tau &amp; \sim N \left( \frac{\sum_{t\ge t^*} y_t \tau}{\sum_{t\ge t^*} 1 \tau + 10^{-8}}, \sum_{t\ge t^*} 1 \tau + 10^{-8} \right)
\end{align}
\]</span></p>
<p>The posterior conditional distribution for <span class="math inline">\(\tau\)</span> needs to be derived from Bayes’ formula.</p>
<p><span class="math display">\[
\tau|x, t^*, \alpha_0, \alpha_1 \sim \text{Gamma} \left( .01 + \frac{n}{2}, .01 + .5 \sum_{t&lt;t^*} (x_t - \alpha_0)^2 + .5 \sum_{t \ge t^*} (x_t - \alpha_1)^2 \right)
\]</span></p>
<p>It is not possible to derive a posterior conditional distribution for <span class="math inline">\(t^*\)</span>, so use the Metropolis-Hastings algorithm. Given <span class="math inline">\(\alpha_0\)</span>, <span class="math inline">\(\alpha_1\)</span>, <span class="math inline">\(\tau\)</span>, and <span class="math inline">\(t^*\)</span>, propose a new value from the normal distribution centered at <span class="math inline">\(t^*\)</span>: <span class="math inline">\(t^{*&#39;} \sim N(t^*, \delta)\)</span> and accept the new value with probability <span class="math inline">\(min{1, R}\)</span>,</p>
<p><span class="math display">\[
R = \frac{f(y|\alpha_0, \alpha_1, t^{*&#39;})f(t^{*&#39;})}{f(y|\alpha_0, \alpha_1, t^*)} \frac{q(t^*|t^{*&#39;})}{q(t^{*&#39;}|t^*)}
\]</span></p>
<p>The proposal distribution is symmetric, so you can drop the <span class="math inline">\(q()\)</span> functions from the ratio (Metropolis algorithm).</p>
<p>Let’s start with a toy example to check the code.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="normal-and-estimating-means.html#cb112-1" tabindex="-1"></a><span class="co"># Create toy data set.</span></span>
<span id="cb112-2"><a href="normal-and-estimating-means.html#cb112-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb112-3"><a href="normal-and-estimating-means.html#cb112-3" tabindex="-1"></a>ALPHA_0 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb112-4"><a href="normal-and-estimating-means.html#cb112-4" tabindex="-1"></a>ALPHA_1 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb112-5"><a href="normal-and-estimating-means.html#cb112-5" tabindex="-1"></a>TAU <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> .<span class="dv">1</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb112-6"><a href="normal-and-estimating-means.html#cb112-6" tabindex="-1"></a>CHGPT <span class="ot">&lt;-</span> <span class="fl">25.5</span></span>
<span id="cb112-7"><a href="normal-and-estimating-means.html#cb112-7" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">t =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, ALPHA_0 <span class="sc">+</span> ALPHA_1<span class="sc">*</span>(t<span class="sc">&gt;</span>CHGPT), <span class="dv">1</span> <span class="sc">/</span> <span class="fu">sqrt</span>(TAU)))</span>
<span id="cb112-8"><a href="normal-and-estimating-means.html#cb112-8" tabindex="-1"></a></span>
<span id="cb112-9"><a href="normal-and-estimating-means.html#cb112-9" tabindex="-1"></a><span class="co"># Quick look at the data. A clear change point!</span></span>
<span id="cb112-10"><a href="normal-and-estimating-means.html#cb112-10" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="statistics_files/figure-html/unnamed-chunk-53-1.png" width="672" /></p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="normal-and-estimating-means.html#cb113-1" tabindex="-1"></a></span>
<span id="cb113-2"><a href="normal-and-estimating-means.html#cb113-2" tabindex="-1"></a><span class="co"># Set up a 1,500 iteration MCMC</span></span>
<span id="cb113-3"><a href="normal-and-estimating-means.html#cb113-3" tabindex="-1"></a>ITER <span class="ot">&lt;-</span> <span class="dv">1500</span></span>
<span id="cb113-4"><a href="normal-and-estimating-means.html#cb113-4" tabindex="-1"></a>chgpt_delta <span class="ot">&lt;-</span> .<span class="dv">5</span></span>
<span id="cb113-5"><a href="normal-and-estimating-means.html#cb113-5" tabindex="-1"></a></span>
<span id="cb113-6"><a href="normal-and-estimating-means.html#cb113-6" tabindex="-1"></a><span class="co"># Create monitors for each of the posterior distributions</span></span>
<span id="cb113-7"><a href="normal-and-estimating-means.html#cb113-7" tabindex="-1"></a>mon_alpha_0 <span class="ot">&lt;-</span> mon_alpha_1 <span class="ot">&lt;-</span> mon_tau <span class="ot">&lt;-</span> mon_chgpt <span class="ot">&lt;-</span> <span class="fu">numeric</span>(ITER)</span>
<span id="cb113-8"><a href="normal-and-estimating-means.html#cb113-8" tabindex="-1"></a></span>
<span id="cb113-9"><a href="normal-and-estimating-means.html#cb113-9" tabindex="-1"></a><span class="co"># Set initial values</span></span>
<span id="cb113-10"><a href="normal-and-estimating-means.html#cb113-10" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(dat)</span>
<span id="cb113-11"><a href="normal-and-estimating-means.html#cb113-11" tabindex="-1"></a>alpha_0 <span class="ot">&lt;-</span> alpha_1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(dat<span class="sc">$</span>y); tau <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> <span class="fu">var</span>(dat<span class="sc">$</span>y); chgpt <span class="ot">&lt;-</span> <span class="fu">median</span>(dat<span class="sc">$</span>t)</span>
<span id="cb113-12"><a href="normal-and-estimating-means.html#cb113-12" tabindex="-1"></a></span>
<span id="cb113-13"><a href="normal-and-estimating-means.html#cb113-13" tabindex="-1"></a><span class="cf">for</span>(iter <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>ITER) {</span>
<span id="cb113-14"><a href="normal-and-estimating-means.html#cb113-14" tabindex="-1"></a>  <span class="co"># Gibbs step</span></span>
<span id="cb113-15"><a href="normal-and-estimating-means.html#cb113-15" tabindex="-1"></a>  alpha_0 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="fu">sum</span>(dat<span class="sc">$</span>y[dat<span class="sc">$</span>t <span class="sc">&lt;</span>  chgpt]) <span class="sc">*</span> tau <span class="sc">/</span> (<span class="fu">sum</span>(dat<span class="sc">$</span>t <span class="sc">&lt;</span>  chgpt) <span class="sc">*</span> tau <span class="sc">+</span> <span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">8</span>)),</span>
<span id="cb113-16"><a href="normal-and-estimating-means.html#cb113-16" tabindex="-1"></a>                   <span class="dv">1</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(dat<span class="sc">$</span>t <span class="sc">&lt;</span>  chgpt) <span class="sc">*</span> tau <span class="sc">+</span> <span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">8</span>)))</span>
<span id="cb113-17"><a href="normal-and-estimating-means.html#cb113-17" tabindex="-1"></a>  alpha_1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="fu">sum</span>(dat<span class="sc">$</span>y[dat<span class="sc">$</span>t <span class="sc">&gt;=</span> chgpt]) <span class="sc">*</span> tau <span class="sc">/</span> (<span class="fu">sum</span>(dat<span class="sc">$</span>t <span class="sc">&gt;=</span> chgpt) <span class="sc">*</span> tau <span class="sc">+</span> <span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">8</span>)),</span>
<span id="cb113-18"><a href="normal-and-estimating-means.html#cb113-18" tabindex="-1"></a>                   <span class="dv">1</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(dat<span class="sc">$</span>t <span class="sc">&gt;=</span> chgpt) <span class="sc">*</span> tau <span class="sc">+</span> <span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">8</span>)))</span>
<span id="cb113-19"><a href="normal-and-estimating-means.html#cb113-19" tabindex="-1"></a>  tau <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(<span class="dv">1</span>, .<span class="dv">01</span> <span class="sc">+</span> n<span class="sc">/</span><span class="dv">2</span>, </span>
<span id="cb113-20"><a href="normal-and-estimating-means.html#cb113-20" tabindex="-1"></a>                .<span class="dv">01</span> <span class="sc">+</span> </span>
<span id="cb113-21"><a href="normal-and-estimating-means.html#cb113-21" tabindex="-1"></a>                  .<span class="dv">5</span> <span class="sc">*</span> <span class="fu">sum</span>(((dat<span class="sc">$</span>y <span class="sc">-</span> alpha_0)<span class="sc">^</span><span class="dv">2</span>)[dat<span class="sc">$</span>t <span class="sc">&lt;</span>  chgpt]) <span class="sc">+</span></span>
<span id="cb113-22"><a href="normal-and-estimating-means.html#cb113-22" tabindex="-1"></a>                  .<span class="dv">5</span> <span class="sc">*</span> <span class="fu">sum</span>(((dat<span class="sc">$</span>y <span class="sc">-</span> alpha_1)<span class="sc">^</span><span class="dv">2</span>)[dat<span class="sc">$</span>t <span class="sc">&gt;=</span> chgpt]))</span>
<span id="cb113-23"><a href="normal-and-estimating-means.html#cb113-23" tabindex="-1"></a>  <span class="co"># c(alpha_0, alpha_1, tau, chgpt)</span></span>
<span id="cb113-24"><a href="normal-and-estimating-means.html#cb113-24" tabindex="-1"></a>  <span class="co"># Metropolis step</span></span>
<span id="cb113-25"><a href="normal-and-estimating-means.html#cb113-25" tabindex="-1"></a>  chgpt_new <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, chgpt, <span class="at">sd =</span> chgpt_delta)</span>
<span id="cb113-26"><a href="normal-and-estimating-means.html#cb113-26" tabindex="-1"></a>  log_R <span class="ot">&lt;-</span> <span class="co"># difference in log-likelihoods =</span></span>
<span id="cb113-27"><a href="normal-and-estimating-means.html#cb113-27" tabindex="-1"></a>    <span class="co"># log-likelihood of new</span></span>
<span id="cb113-28"><a href="normal-and-estimating-means.html#cb113-28" tabindex="-1"></a>    (<span class="fu">sum</span>(<span class="fu">dnorm</span>(dat<span class="sc">$</span>y[dat<span class="sc">$</span>t <span class="sc">&lt;</span>  chgpt_new], alpha_0, <span class="dv">1</span> <span class="sc">/</span> <span class="fu">sqrt</span>(tau), <span class="at">log =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb113-29"><a href="normal-and-estimating-means.html#cb113-29" tabindex="-1"></a>     <span class="fu">sum</span>(<span class="fu">dnorm</span>(dat<span class="sc">$</span>y[dat<span class="sc">$</span>t <span class="sc">&gt;=</span> chgpt_new], alpha_1, <span class="dv">1</span> <span class="sc">/</span> <span class="fu">sqrt</span>(tau), <span class="at">log =</span> <span class="cn">TRUE</span>))) <span class="sc">-</span></span>
<span id="cb113-30"><a href="normal-and-estimating-means.html#cb113-30" tabindex="-1"></a>    <span class="co"># log-likelihood of curr</span></span>
<span id="cb113-31"><a href="normal-and-estimating-means.html#cb113-31" tabindex="-1"></a>    (<span class="fu">sum</span>(<span class="fu">dnorm</span>(dat<span class="sc">$</span>y[dat<span class="sc">$</span>t <span class="sc">&lt;</span>  chgpt],     alpha_0, <span class="dv">1</span> <span class="sc">/</span> <span class="fu">sqrt</span>(tau), <span class="at">log =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb113-32"><a href="normal-and-estimating-means.html#cb113-32" tabindex="-1"></a>     <span class="fu">sum</span>(<span class="fu">dnorm</span>(dat<span class="sc">$</span>y[dat<span class="sc">$</span>t <span class="sc">&gt;=</span> chgpt],     alpha_1, <span class="dv">1</span> <span class="sc">/</span> <span class="fu">sqrt</span>(tau), <span class="at">log =</span> <span class="cn">TRUE</span>))) </span>
<span id="cb113-33"><a href="normal-and-estimating-means.html#cb113-33" tabindex="-1"></a>  log_U <span class="ot">&lt;-</span> <span class="fu">log</span>(<span class="fu">runif</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb113-34"><a href="normal-and-estimating-means.html#cb113-34" tabindex="-1"></a>  <span class="cf">if</span>(log_U <span class="sc">&lt;</span> log_R) { chgpt <span class="ot">&lt;-</span> chgpt_new}</span>
<span id="cb113-35"><a href="normal-and-estimating-means.html#cb113-35" tabindex="-1"></a>  <span class="co"># update monitors</span></span>
<span id="cb113-36"><a href="normal-and-estimating-means.html#cb113-36" tabindex="-1"></a>  mon_alpha_0[iter] <span class="ot">&lt;-</span> alpha_0 </span>
<span id="cb113-37"><a href="normal-and-estimating-means.html#cb113-37" tabindex="-1"></a>  mon_alpha_1[iter] <span class="ot">&lt;-</span> alpha_1</span>
<span id="cb113-38"><a href="normal-and-estimating-means.html#cb113-38" tabindex="-1"></a>  mon_tau[iter] <span class="ot">&lt;-</span> tau</span>
<span id="cb113-39"><a href="normal-and-estimating-means.html#cb113-39" tabindex="-1"></a>  mon_chgpt[iter] <span class="ot">&lt;-</span> chgpt</span>
<span id="cb113-40"><a href="normal-and-estimating-means.html#cb113-40" tabindex="-1"></a>}</span>
<span id="cb113-41"><a href="normal-and-estimating-means.html#cb113-41" tabindex="-1"></a><span class="co"># mine &lt;- c(alpha_0, alpha_1, tau, chgpt, chgpt_new, log_R, log_U)</span></span>
<span id="cb113-42"><a href="normal-and-estimating-means.html#cb113-42" tabindex="-1"></a></span>
<span id="cb113-43"><a href="normal-and-estimating-means.html#cb113-43" tabindex="-1"></a><span class="co"># Check for convergence</span></span>
<span id="cb113-44"><a href="normal-and-estimating-means.html#cb113-44" tabindex="-1"></a>mon_tibble <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">index =</span> <span class="dv">1</span><span class="sc">:</span>ITER, <span class="at">alpha_0 =</span> mon_alpha_0, <span class="at">alpha_1 =</span> mon_alpha_1, </span>
<span id="cb113-45"><a href="normal-and-estimating-means.html#cb113-45" tabindex="-1"></a>       <span class="at">tau =</span> mon_tau, <span class="at">chgpt =</span> mon_chgpt) </span>
<span id="cb113-46"><a href="normal-and-estimating-means.html#cb113-46" tabindex="-1"></a>mon_tibble_longer <span class="ot">&lt;-</span></span>
<span id="cb113-47"><a href="normal-and-estimating-means.html#cb113-47" tabindex="-1"></a>  mon_tibble <span class="sc">%&gt;%</span></span>
<span id="cb113-48"><a href="normal-and-estimating-means.html#cb113-48" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>index)</span>
<span id="cb113-49"><a href="normal-and-estimating-means.html#cb113-49" tabindex="-1"></a></span>
<span id="cb113-50"><a href="normal-and-estimating-means.html#cb113-50" tabindex="-1"></a>mon_tibble_longer <span class="sc">%&gt;%</span> </span>
<span id="cb113-51"><a href="normal-and-estimating-means.html#cb113-51" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> value)) <span class="sc">+</span> </span>
<span id="cb113-52"><a href="normal-and-estimating-means.html#cb113-52" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb113-53"><a href="normal-and-estimating-means.html#cb113-53" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb113-54"><a href="normal-and-estimating-means.html#cb113-54" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span> <span class="fu">vars</span>(name), <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<p><img src="statistics_files/figure-html/unnamed-chunk-53-2.png" width="672" /></p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="normal-and-estimating-means.html#cb114-1" tabindex="-1"></a></span>
<span id="cb114-2"><a href="normal-and-estimating-means.html#cb114-2" tabindex="-1"></a><span class="co"># Convergence after 500 iterations, so throw them out.</span></span>
<span id="cb114-3"><a href="normal-and-estimating-means.html#cb114-3" tabindex="-1"></a><span class="co"># Posterior distributions</span></span>
<span id="cb114-4"><a href="normal-and-estimating-means.html#cb114-4" tabindex="-1"></a>mon_tibble_longer <span class="sc">%&gt;%</span> </span>
<span id="cb114-5"><a href="normal-and-estimating-means.html#cb114-5" tabindex="-1"></a>  <span class="fu">filter</span>(index <span class="sc">&gt;</span> <span class="dv">500</span>) <span class="sc">%&gt;%</span></span>
<span id="cb114-6"><a href="normal-and-estimating-means.html#cb114-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">if_else</span>(name <span class="sc">==</span> <span class="st">&quot;tau&quot;</span>, <span class="st">&quot;sigma&quot;</span>, name),</span>
<span id="cb114-7"><a href="normal-and-estimating-means.html#cb114-7" tabindex="-1"></a>         <span class="at">value =</span> <span class="fu">if_else</span>(name <span class="sc">==</span> <span class="st">&quot;sigma&quot;</span>, <span class="dv">1</span> <span class="sc">/</span> <span class="fu">sqrt</span>(value), value)) <span class="sc">%&gt;%</span></span>
<span id="cb114-8"><a href="normal-and-estimating-means.html#cb114-8" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb114-9"><a href="normal-and-estimating-means.html#cb114-9" tabindex="-1"></a>    <span class="at">.by =</span> name,</span>
<span id="cb114-10"><a href="normal-and-estimating-means.html#cb114-10" tabindex="-1"></a>    <span class="at">M =</span> <span class="fu">mean</span>(value),</span>
<span id="cb114-11"><a href="normal-and-estimating-means.html#cb114-11" tabindex="-1"></a>    <span class="at">SD =</span> <span class="fu">sd</span>(value),</span>
<span id="cb114-12"><a href="normal-and-estimating-means.html#cb114-12" tabindex="-1"></a>    <span class="at">LCI =</span> <span class="fu">quantile</span>(value, .<span class="dv">025</span>),</span>
<span id="cb114-13"><a href="normal-and-estimating-means.html#cb114-13" tabindex="-1"></a>    <span class="at">UCI =</span> <span class="fu">quantile</span>(value, .<span class="dv">975</span>)</span>
<span id="cb114-14"><a href="normal-and-estimating-means.html#cb114-14" tabindex="-1"></a>  )</span>
<span id="cb114-15"><a href="normal-and-estimating-means.html#cb114-15" tabindex="-1"></a><span class="do">## Warning: There was 1 warning in `mutate()`.</span></span>
<span id="cb114-16"><a href="normal-and-estimating-means.html#cb114-16" tabindex="-1"></a><span class="do">## ℹ In argument: `value = if_else(name == &quot;sigma&quot;, 1/sqrt(value), value)`.</span></span>
<span id="cb114-17"><a href="normal-and-estimating-means.html#cb114-17" tabindex="-1"></a><span class="do">## Caused by warning in `sqrt()`:</span></span>
<span id="cb114-18"><a href="normal-and-estimating-means.html#cb114-18" tabindex="-1"></a><span class="do">## ! NaNs produced</span></span>
<span id="cb114-19"><a href="normal-and-estimating-means.html#cb114-19" tabindex="-1"></a><span class="do">## # A tibble: 4 × 5</span></span>
<span id="cb114-20"><a href="normal-and-estimating-means.html#cb114-20" tabindex="-1"></a><span class="do">##   name           M      SD     LCI     UCI</span></span>
<span id="cb114-21"><a href="normal-and-estimating-means.html#cb114-21" tabindex="-1"></a><span class="do">##   &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb114-22"><a href="normal-and-estimating-means.html#cb114-22" tabindex="-1"></a><span class="do">## 1 alpha_0  0.00100 0.0225  -0.0431  0.0462</span></span>
<span id="cb114-23"><a href="normal-and-estimating-means.html#cb114-23" tabindex="-1"></a><span class="do">## 2 alpha_1  1.03    0.0125   1.01    1.06  </span></span>
<span id="cb114-24"><a href="normal-and-estimating-means.html#cb114-24" tabindex="-1"></a><span class="do">## 3 sigma    0.113   0.00822  0.0986  0.130 </span></span>
<span id="cb114-25"><a href="normal-and-estimating-means.html#cb114-25" tabindex="-1"></a><span class="do">## 4 chgpt   25.5     0.287   25.0    26.0</span></span>
<span id="cb114-26"><a href="normal-and-estimating-means.html#cb114-26" tabindex="-1"></a></span>
<span id="cb114-27"><a href="normal-and-estimating-means.html#cb114-27" tabindex="-1"></a><span class="co"># You can summarize the values by t to average the models.</span></span>
<span id="cb114-28"><a href="normal-and-estimating-means.html#cb114-28" tabindex="-1"></a><span class="co"># Recall the model is mu_t = alpha + beta*Year where alpha = alpha_0 or alpha_1</span></span>
<span id="cb114-29"><a href="normal-and-estimating-means.html#cb114-29" tabindex="-1"></a>mon_tibble <span class="sc">%&gt;%</span></span>
<span id="cb114-30"><a href="normal-and-estimating-means.html#cb114-30" tabindex="-1"></a>  <span class="fu">head</span>(<span class="sc">-</span><span class="dv">500</span>) <span class="sc">%&gt;%</span></span>
<span id="cb114-31"><a href="normal-and-estimating-means.html#cb114-31" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb114-32"><a href="normal-and-estimating-means.html#cb114-32" tabindex="-1"></a>    <span class="at">series =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(alpha_0, alpha_1, chgpt), <span class="cf">function</span>(a0, a1, c) {</span>
<span id="cb114-33"><a href="normal-and-estimating-means.html#cb114-33" tabindex="-1"></a>      t <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span></span>
<span id="cb114-34"><a href="normal-and-estimating-means.html#cb114-34" tabindex="-1"></a>      y <span class="ot">&lt;-</span> <span class="fu">if_else</span>(t <span class="sc">&lt;</span> c, a0, a1)</span>
<span id="cb114-35"><a href="normal-and-estimating-means.html#cb114-35" tabindex="-1"></a>      rs <span class="ot">&lt;-</span> <span class="fu">tibble</span>(t, y)</span>
<span id="cb114-36"><a href="normal-and-estimating-means.html#cb114-36" tabindex="-1"></a>      rs</span>
<span id="cb114-37"><a href="normal-and-estimating-means.html#cb114-37" tabindex="-1"></a>    })</span>
<span id="cb114-38"><a href="normal-and-estimating-means.html#cb114-38" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb114-39"><a href="normal-and-estimating-means.html#cb114-39" tabindex="-1"></a>  <span class="fu">select</span>(series) <span class="sc">%&gt;%</span></span>
<span id="cb114-40"><a href="normal-and-estimating-means.html#cb114-40" tabindex="-1"></a>  <span class="fu">unnest</span>(series) <span class="sc">%&gt;%</span></span>
<span id="cb114-41"><a href="normal-and-estimating-means.html#cb114-41" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">.by =</span> t, <span class="at">y =</span> <span class="fu">mean</span>(y), <span class="at">lci =</span> <span class="fu">quantile</span>(y, .<span class="dv">025</span>), <span class="at">uci =</span> <span class="fu">quantile</span>(y, .<span class="dv">975</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb114-42"><a href="normal-and-estimating-means.html#cb114-42" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> t)) <span class="sc">+</span></span>
<span id="cb114-43"><a href="normal-and-estimating-means.html#cb114-43" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb114-44"><a href="normal-and-estimating-means.html#cb114-44" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lci, <span class="at">ymax =</span> uci))</span></code></pre></div>
<p><img src="statistics_files/figure-html/unnamed-chunk-53-3.png" width="672" /></p>
<p>Now let’s apply what we’ve learned to the Nile data set. I’ll set the initial change point value at 1900 since that is around where the change seems to have occurred.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="normal-and-estimating-means.html#cb115-1" tabindex="-1"></a>dat <span class="ot">&lt;-</span> my_nile <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">t =</span> year, <span class="at">y =</span> flow)</span>
<span id="cb115-2"><a href="normal-and-estimating-means.html#cb115-2" tabindex="-1"></a></span>
<span id="cb115-3"><a href="normal-and-estimating-means.html#cb115-3" tabindex="-1"></a><span class="co"># Quick look at the data. A clear change point!</span></span>
<span id="cb115-4"><a href="normal-and-estimating-means.html#cb115-4" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">geom_line</span>()</span>
<span id="cb115-5"><a href="normal-and-estimating-means.html#cb115-5" tabindex="-1"></a><span class="do">## Don&#39;t know how to automatically pick scale for object of type &lt;ts&gt;. Defaulting</span></span>
<span id="cb115-6"><a href="normal-and-estimating-means.html#cb115-6" tabindex="-1"></a><span class="do">## to continuous.</span></span>
<span id="cb115-7"><a href="normal-and-estimating-means.html#cb115-7" tabindex="-1"></a><span class="do">## Don&#39;t know how to automatically pick scale for object of type &lt;ts&gt;. Defaulting</span></span>
<span id="cb115-8"><a href="normal-and-estimating-means.html#cb115-8" tabindex="-1"></a><span class="do">## to continuous.</span></span></code></pre></div>
<p><img src="statistics_files/figure-html/unnamed-chunk-54-1.png" width="672" /></p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="normal-and-estimating-means.html#cb116-1" tabindex="-1"></a></span>
<span id="cb116-2"><a href="normal-and-estimating-means.html#cb116-2" tabindex="-1"></a><span class="co"># Set up a 1,500 iteration MCMC</span></span>
<span id="cb116-3"><a href="normal-and-estimating-means.html#cb116-3" tabindex="-1"></a>ITER <span class="ot">&lt;-</span> <span class="dv">1500</span></span>
<span id="cb116-4"><a href="normal-and-estimating-means.html#cb116-4" tabindex="-1"></a>chgpt_delta <span class="ot">&lt;-</span> .<span class="dv">5</span></span>
<span id="cb116-5"><a href="normal-and-estimating-means.html#cb116-5" tabindex="-1"></a></span>
<span id="cb116-6"><a href="normal-and-estimating-means.html#cb116-6" tabindex="-1"></a><span class="co"># Create monitors for each of the posterior distributions</span></span>
<span id="cb116-7"><a href="normal-and-estimating-means.html#cb116-7" tabindex="-1"></a>mon_alpha_0 <span class="ot">&lt;-</span> mon_alpha_1 <span class="ot">&lt;-</span> mon_tau <span class="ot">&lt;-</span> mon_chgpt <span class="ot">&lt;-</span> <span class="fu">numeric</span>(ITER)</span>
<span id="cb116-8"><a href="normal-and-estimating-means.html#cb116-8" tabindex="-1"></a></span>
<span id="cb116-9"><a href="normal-and-estimating-means.html#cb116-9" tabindex="-1"></a><span class="co"># Set initial values</span></span>
<span id="cb116-10"><a href="normal-and-estimating-means.html#cb116-10" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(dat)</span>
<span id="cb116-11"><a href="normal-and-estimating-means.html#cb116-11" tabindex="-1"></a>alpha_0 <span class="ot">&lt;-</span> alpha_1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(dat<span class="sc">$</span>y); tau <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> <span class="fu">var</span>(dat<span class="sc">$</span>y); chgpt <span class="ot">&lt;-</span> <span class="dv">1900</span></span>
<span id="cb116-12"><a href="normal-and-estimating-means.html#cb116-12" tabindex="-1"></a></span>
<span id="cb116-13"><a href="normal-and-estimating-means.html#cb116-13" tabindex="-1"></a><span class="cf">for</span>(iter <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>ITER) {</span>
<span id="cb116-14"><a href="normal-and-estimating-means.html#cb116-14" tabindex="-1"></a>  <span class="co"># Gibbs step</span></span>
<span id="cb116-15"><a href="normal-and-estimating-means.html#cb116-15" tabindex="-1"></a>  alpha_0 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="fu">sum</span>(dat<span class="sc">$</span>y[dat<span class="sc">$</span>t <span class="sc">&lt;</span>  chgpt]) <span class="sc">*</span> tau <span class="sc">/</span> (<span class="fu">sum</span>(dat<span class="sc">$</span>t <span class="sc">&lt;</span>  chgpt) <span class="sc">*</span> tau <span class="sc">+</span> <span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">8</span>)),</span>
<span id="cb116-16"><a href="normal-and-estimating-means.html#cb116-16" tabindex="-1"></a>                   <span class="dv">1</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(dat<span class="sc">$</span>t <span class="sc">&lt;</span>  chgpt) <span class="sc">*</span> tau <span class="sc">+</span> <span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">8</span>)))</span>
<span id="cb116-17"><a href="normal-and-estimating-means.html#cb116-17" tabindex="-1"></a>  alpha_1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="fu">sum</span>(dat<span class="sc">$</span>y[dat<span class="sc">$</span>t <span class="sc">&gt;=</span> chgpt]) <span class="sc">*</span> tau <span class="sc">/</span> (<span class="fu">sum</span>(dat<span class="sc">$</span>t <span class="sc">&gt;=</span> chgpt) <span class="sc">*</span> tau <span class="sc">+</span> <span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">8</span>)),</span>
<span id="cb116-18"><a href="normal-and-estimating-means.html#cb116-18" tabindex="-1"></a>                   <span class="dv">1</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(dat<span class="sc">$</span>t <span class="sc">&gt;=</span> chgpt) <span class="sc">*</span> tau <span class="sc">+</span> <span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">8</span>)))</span>
<span id="cb116-19"><a href="normal-and-estimating-means.html#cb116-19" tabindex="-1"></a>  tau <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(<span class="dv">1</span>, .<span class="dv">01</span> <span class="sc">+</span> n<span class="sc">/</span><span class="dv">2</span>, </span>
<span id="cb116-20"><a href="normal-and-estimating-means.html#cb116-20" tabindex="-1"></a>                .<span class="dv">01</span> <span class="sc">+</span> </span>
<span id="cb116-21"><a href="normal-and-estimating-means.html#cb116-21" tabindex="-1"></a>                  .<span class="dv">5</span> <span class="sc">*</span> <span class="fu">sum</span>(((dat<span class="sc">$</span>y <span class="sc">-</span> alpha_0)<span class="sc">^</span><span class="dv">2</span>)[dat<span class="sc">$</span>t <span class="sc">&lt;</span>  chgpt]) <span class="sc">+</span></span>
<span id="cb116-22"><a href="normal-and-estimating-means.html#cb116-22" tabindex="-1"></a>                  .<span class="dv">5</span> <span class="sc">*</span> <span class="fu">sum</span>(((dat<span class="sc">$</span>y <span class="sc">-</span> alpha_1)<span class="sc">^</span><span class="dv">2</span>)[dat<span class="sc">$</span>t <span class="sc">&gt;=</span> chgpt]))</span>
<span id="cb116-23"><a href="normal-and-estimating-means.html#cb116-23" tabindex="-1"></a>  <span class="co"># c(alpha_0, alpha_1, tau, chgpt)</span></span>
<span id="cb116-24"><a href="normal-and-estimating-means.html#cb116-24" tabindex="-1"></a>  <span class="co"># Metropolis step</span></span>
<span id="cb116-25"><a href="normal-and-estimating-means.html#cb116-25" tabindex="-1"></a>  chgpt_new <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, chgpt, <span class="at">sd =</span> chgpt_delta)</span>
<span id="cb116-26"><a href="normal-and-estimating-means.html#cb116-26" tabindex="-1"></a>  log_R <span class="ot">&lt;-</span> <span class="co"># difference in log-likelihoods =</span></span>
<span id="cb116-27"><a href="normal-and-estimating-means.html#cb116-27" tabindex="-1"></a>    <span class="co"># log-likelihood of new</span></span>
<span id="cb116-28"><a href="normal-and-estimating-means.html#cb116-28" tabindex="-1"></a>    (<span class="fu">sum</span>(<span class="fu">dnorm</span>(dat<span class="sc">$</span>y[dat<span class="sc">$</span>t <span class="sc">&lt;</span>  chgpt_new], alpha_0, <span class="dv">1</span> <span class="sc">/</span> <span class="fu">sqrt</span>(tau), <span class="at">log =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb116-29"><a href="normal-and-estimating-means.html#cb116-29" tabindex="-1"></a>     <span class="fu">sum</span>(<span class="fu">dnorm</span>(dat<span class="sc">$</span>y[dat<span class="sc">$</span>t <span class="sc">&gt;=</span> chgpt_new], alpha_1, <span class="dv">1</span> <span class="sc">/</span> <span class="fu">sqrt</span>(tau), <span class="at">log =</span> <span class="cn">TRUE</span>))) <span class="sc">-</span></span>
<span id="cb116-30"><a href="normal-and-estimating-means.html#cb116-30" tabindex="-1"></a>    <span class="co"># log-likelihood of curr</span></span>
<span id="cb116-31"><a href="normal-and-estimating-means.html#cb116-31" tabindex="-1"></a>    (<span class="fu">sum</span>(<span class="fu">dnorm</span>(dat<span class="sc">$</span>y[dat<span class="sc">$</span>t <span class="sc">&lt;</span>  chgpt],     alpha_0, <span class="dv">1</span> <span class="sc">/</span> <span class="fu">sqrt</span>(tau), <span class="at">log =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb116-32"><a href="normal-and-estimating-means.html#cb116-32" tabindex="-1"></a>     <span class="fu">sum</span>(<span class="fu">dnorm</span>(dat<span class="sc">$</span>y[dat<span class="sc">$</span>t <span class="sc">&gt;=</span> chgpt],     alpha_1, <span class="dv">1</span> <span class="sc">/</span> <span class="fu">sqrt</span>(tau), <span class="at">log =</span> <span class="cn">TRUE</span>))) </span>
<span id="cb116-33"><a href="normal-and-estimating-means.html#cb116-33" tabindex="-1"></a>  log_U <span class="ot">&lt;-</span> <span class="fu">log</span>(<span class="fu">runif</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb116-34"><a href="normal-and-estimating-means.html#cb116-34" tabindex="-1"></a>  <span class="cf">if</span>(log_U <span class="sc">&lt;</span> log_R) { chgpt <span class="ot">&lt;-</span> chgpt_new}</span>
<span id="cb116-35"><a href="normal-and-estimating-means.html#cb116-35" tabindex="-1"></a>  <span class="co"># update monitors</span></span>
<span id="cb116-36"><a href="normal-and-estimating-means.html#cb116-36" tabindex="-1"></a>  mon_alpha_0[iter] <span class="ot">&lt;-</span> alpha_0 </span>
<span id="cb116-37"><a href="normal-and-estimating-means.html#cb116-37" tabindex="-1"></a>  mon_alpha_1[iter] <span class="ot">&lt;-</span> alpha_1</span>
<span id="cb116-38"><a href="normal-and-estimating-means.html#cb116-38" tabindex="-1"></a>  mon_tau[iter] <span class="ot">&lt;-</span> tau</span>
<span id="cb116-39"><a href="normal-and-estimating-means.html#cb116-39" tabindex="-1"></a>  mon_chgpt[iter] <span class="ot">&lt;-</span> chgpt</span>
<span id="cb116-40"><a href="normal-and-estimating-means.html#cb116-40" tabindex="-1"></a>}</span>
<span id="cb116-41"><a href="normal-and-estimating-means.html#cb116-41" tabindex="-1"></a><span class="co"># mine &lt;- c(alpha_0, alpha_1, tau, chgpt, chgpt_new, log_R, log_U)</span></span>
<span id="cb116-42"><a href="normal-and-estimating-means.html#cb116-42" tabindex="-1"></a></span>
<span id="cb116-43"><a href="normal-and-estimating-means.html#cb116-43" tabindex="-1"></a><span class="co"># Check for convergence</span></span>
<span id="cb116-44"><a href="normal-and-estimating-means.html#cb116-44" tabindex="-1"></a>mon_tibble <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">index =</span> <span class="dv">1</span><span class="sc">:</span>ITER, <span class="at">alpha_0 =</span> mon_alpha_0, <span class="at">alpha_1 =</span> mon_alpha_1, </span>
<span id="cb116-45"><a href="normal-and-estimating-means.html#cb116-45" tabindex="-1"></a>       <span class="at">tau =</span> mon_tau, <span class="at">chgpt =</span> mon_chgpt) </span>
<span id="cb116-46"><a href="normal-and-estimating-means.html#cb116-46" tabindex="-1"></a>mon_tibble_longer <span class="ot">&lt;-</span></span>
<span id="cb116-47"><a href="normal-and-estimating-means.html#cb116-47" tabindex="-1"></a>  mon_tibble <span class="sc">%&gt;%</span></span>
<span id="cb116-48"><a href="normal-and-estimating-means.html#cb116-48" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>index)</span>
<span id="cb116-49"><a href="normal-and-estimating-means.html#cb116-49" tabindex="-1"></a></span>
<span id="cb116-50"><a href="normal-and-estimating-means.html#cb116-50" tabindex="-1"></a>mon_tibble_longer <span class="sc">%&gt;%</span> </span>
<span id="cb116-51"><a href="normal-and-estimating-means.html#cb116-51" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> value)) <span class="sc">+</span> </span>
<span id="cb116-52"><a href="normal-and-estimating-means.html#cb116-52" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb116-53"><a href="normal-and-estimating-means.html#cb116-53" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb116-54"><a href="normal-and-estimating-means.html#cb116-54" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span> <span class="fu">vars</span>(name), <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<p><img src="statistics_files/figure-html/unnamed-chunk-54-2.png" width="672" /></p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="normal-and-estimating-means.html#cb117-1" tabindex="-1"></a></span>
<span id="cb117-2"><a href="normal-and-estimating-means.html#cb117-2" tabindex="-1"></a><span class="co"># Convergence after 500 iterations, so throw them out.</span></span>
<span id="cb117-3"><a href="normal-and-estimating-means.html#cb117-3" tabindex="-1"></a><span class="co"># Posterior distributions</span></span>
<span id="cb117-4"><a href="normal-and-estimating-means.html#cb117-4" tabindex="-1"></a>mon_tibble_longer <span class="sc">%&gt;%</span> </span>
<span id="cb117-5"><a href="normal-and-estimating-means.html#cb117-5" tabindex="-1"></a>  <span class="fu">filter</span>(index <span class="sc">&gt;</span> <span class="dv">500</span>) <span class="sc">%&gt;%</span></span>
<span id="cb117-6"><a href="normal-and-estimating-means.html#cb117-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">if_else</span>(name <span class="sc">==</span> <span class="st">&quot;tau&quot;</span>, <span class="st">&quot;sigma&quot;</span>, name),</span>
<span id="cb117-7"><a href="normal-and-estimating-means.html#cb117-7" tabindex="-1"></a>         <span class="at">value =</span> <span class="fu">if_else</span>(name <span class="sc">==</span> <span class="st">&quot;sigma&quot;</span>, <span class="dv">1</span> <span class="sc">/</span> <span class="fu">sqrt</span>(value), value)) <span class="sc">%&gt;%</span></span>
<span id="cb117-8"><a href="normal-and-estimating-means.html#cb117-8" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb117-9"><a href="normal-and-estimating-means.html#cb117-9" tabindex="-1"></a>    <span class="at">.by =</span> name,</span>
<span id="cb117-10"><a href="normal-and-estimating-means.html#cb117-10" tabindex="-1"></a>    <span class="at">M =</span> <span class="fu">mean</span>(value),</span>
<span id="cb117-11"><a href="normal-and-estimating-means.html#cb117-11" tabindex="-1"></a>    <span class="at">SD =</span> <span class="fu">sd</span>(value),</span>
<span id="cb117-12"><a href="normal-and-estimating-means.html#cb117-12" tabindex="-1"></a>    <span class="at">LCI =</span> <span class="fu">quantile</span>(value, .<span class="dv">025</span>),</span>
<span id="cb117-13"><a href="normal-and-estimating-means.html#cb117-13" tabindex="-1"></a>    <span class="at">UCI =</span> <span class="fu">quantile</span>(value, .<span class="dv">975</span>)</span>
<span id="cb117-14"><a href="normal-and-estimating-means.html#cb117-14" tabindex="-1"></a>  )</span>
<span id="cb117-15"><a href="normal-and-estimating-means.html#cb117-15" tabindex="-1"></a><span class="do">## # A tibble: 4 × 5</span></span>
<span id="cb117-16"><a href="normal-and-estimating-means.html#cb117-16" tabindex="-1"></a><span class="do">##   name        M     SD   LCI   UCI</span></span>
<span id="cb117-17"><a href="normal-and-estimating-means.html#cb117-17" tabindex="-1"></a><span class="do">##   &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb117-18"><a href="normal-and-estimating-means.html#cb117-18" tabindex="-1"></a><span class="do">## 1 alpha_0 1097. 24.3   1049. 1144.</span></span>
<span id="cb117-19"><a href="normal-and-estimating-means.html#cb117-19" tabindex="-1"></a><span class="do">## 2 alpha_1  850. 15.8    819.  881.</span></span>
<span id="cb117-20"><a href="normal-and-estimating-means.html#cb117-20" tabindex="-1"></a><span class="do">## 3 sigma    130.  9.31   113.  150.</span></span>
<span id="cb117-21"><a href="normal-and-estimating-means.html#cb117-21" tabindex="-1"></a><span class="do">## 4 chgpt   1898.  0.728 1896. 1899.</span></span>
<span id="cb117-22"><a href="normal-and-estimating-means.html#cb117-22" tabindex="-1"></a></span>
<span id="cb117-23"><a href="normal-and-estimating-means.html#cb117-23" tabindex="-1"></a><span class="co"># You can summarize the values by t to average the models.</span></span>
<span id="cb117-24"><a href="normal-and-estimating-means.html#cb117-24" tabindex="-1"></a><span class="co"># Recall the model is mu_t = alpha + beta*Year where alpha = alpha_0 or alpha_1</span></span>
<span id="cb117-25"><a href="normal-and-estimating-means.html#cb117-25" tabindex="-1"></a>mon_tibble <span class="sc">%&gt;%</span></span>
<span id="cb117-26"><a href="normal-and-estimating-means.html#cb117-26" tabindex="-1"></a>  <span class="fu">head</span>(<span class="sc">-</span><span class="dv">500</span>) <span class="sc">%&gt;%</span></span>
<span id="cb117-27"><a href="normal-and-estimating-means.html#cb117-27" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb117-28"><a href="normal-and-estimating-means.html#cb117-28" tabindex="-1"></a>    <span class="at">series =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(alpha_0, alpha_1, chgpt), <span class="cf">function</span>(a0, a1, c) {</span>
<span id="cb117-29"><a href="normal-and-estimating-means.html#cb117-29" tabindex="-1"></a>      t <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span></span>
<span id="cb117-30"><a href="normal-and-estimating-means.html#cb117-30" tabindex="-1"></a>      y <span class="ot">&lt;-</span> <span class="fu">if_else</span>(t <span class="sc">&lt;</span> c, a0, a1)</span>
<span id="cb117-31"><a href="normal-and-estimating-means.html#cb117-31" tabindex="-1"></a>      rs <span class="ot">&lt;-</span> <span class="fu">tibble</span>(t, y)</span>
<span id="cb117-32"><a href="normal-and-estimating-means.html#cb117-32" tabindex="-1"></a>      rs</span>
<span id="cb117-33"><a href="normal-and-estimating-means.html#cb117-33" tabindex="-1"></a>    })</span>
<span id="cb117-34"><a href="normal-and-estimating-means.html#cb117-34" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb117-35"><a href="normal-and-estimating-means.html#cb117-35" tabindex="-1"></a>  <span class="fu">select</span>(series) <span class="sc">%&gt;%</span></span>
<span id="cb117-36"><a href="normal-and-estimating-means.html#cb117-36" tabindex="-1"></a>  <span class="fu">unnest</span>(series) <span class="sc">%&gt;%</span></span>
<span id="cb117-37"><a href="normal-and-estimating-means.html#cb117-37" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">.by =</span> t, <span class="at">y =</span> <span class="fu">mean</span>(y), <span class="at">lci =</span> <span class="fu">quantile</span>(y, .<span class="dv">025</span>), <span class="at">uci =</span> <span class="fu">quantile</span>(y, .<span class="dv">975</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb117-38"><a href="normal-and-estimating-means.html#cb117-38" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> t)) <span class="sc">+</span></span>
<span id="cb117-39"><a href="normal-and-estimating-means.html#cb117-39" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb117-40"><a href="normal-and-estimating-means.html#cb117-40" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lci, <span class="at">ymax =</span> uci))</span></code></pre></div>
<p><img src="statistics_files/figure-html/unnamed-chunk-54-3.png" width="672" /></p>
</div>
<div id="cluster-analysis" class="section level3 hasAnchor" number="3.5.6">
<h3><span class="header-section-number">3.5.6</span> Cluster Analysis<a href="normal-and-estimating-means.html#cluster-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You can use Bayes for mixtures. Suppose you have a mixture of <span class="math inline">\(z_i \in [1, 2, 3]\)</span> types of grains with mean diameters of 3.8, 5, and 8mm. Given a grain of diameter <span class="math inline">\(x_i\)</span>, what is its class, <span class="math inline">\(z_i\)</span>?</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="normal-and-estimating-means.html#cb118-1" tabindex="-1"></a>cinderella <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb118-2"><a href="normal-and-estimating-means.html#cb118-2" tabindex="-1"></a>  <span class="at">z =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">200</span>), <span class="fu">rep</span>(<span class="dv">2</span>, <span class="dv">100</span>), <span class="fu">rep</span>(<span class="dv">3</span>, <span class="dv">300</span>)),</span>
<span id="cb118-3"><a href="normal-and-estimating-means.html#cb118-3" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="fu">rnorm</span>(<span class="dv">200</span>, <span class="fl">3.8</span>, .<span class="dv">25</span>), <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="dv">5</span>, .<span class="dv">5</span>), <span class="fu">rnorm</span>(<span class="dv">300</span>, <span class="dv">8</span>, <span class="dv">1</span>))</span>
<span id="cb118-4"><a href="normal-and-estimating-means.html#cb118-4" tabindex="-1"></a>)</span></code></pre></div>
<p>You might start with the assumption that <span class="math inline">\((x_i|z_i, \mu_{z_i}, \tau_{z_i}) \sim N(\mu_{z_i}, \tau_{z_i})\)</span> and assign conjugate priors <span class="math inline">\(\mu_k \sim N(\mu_{k0}, \tau_{k0})\)</span> and <span class="math inline">\(\tau_k \sim \text{Gamma}(a_k, b_k)\)</span> for <span class="math inline">\(k = 1, \ldots, 3\)</span>. To estimate the class probabilities of each grain, you need to start with a prior. <span class="math inline">\(Pr(z_i = k) = 1/K = 1/3\)</span> is a good prior.</p>
<p>The problem becomes</p>
<p><span class="math display">\[
\begin{align}
Pr(z_i = k|x_i, \mu_k, \tau_k) &amp;= \frac{f(x_i|z_i = k, \mu_k, \tau_k) Pr(z_i = k)}{\sum_k f(x_i|z_i = k, \mu_k, \tau_k) Pr(z_i = k)} \\
&amp;= \frac{f(x_i|z_i = k, \mu_k, \tau_k)}{\sum_k f(x_i|z_i = k, \mu_k, \tau_k)}
\end{align}
\]</span></p>
<p><code>NMixMCMC()</code> assigns initial values for <span class="math inline">\(\mu s\)</span>, <span class="math inline">\(\tau s\)</span> and <span class="math inline">\(z_i s\)</span>. Given <span class="math inline">\(\mu s\)</span> and <span class="math inline">\(\tau s\)</span>, it samples <span class="math inline">\(z_i s\)</span> from the assumed distribution. For each group, <span class="math inline">\(k\)</span>, sample <span class="math inline">\(\mu_k\)</span> and then <span class="math inline">\(\tau_k\)</span> from the conjugate conditional posterior distribution. Then repeat until convergence.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="normal-and-estimating-means.html#cb119-1" tabindex="-1"></a><span class="fu">library</span>(mixAK)</span>
<span id="cb119-2"><a href="normal-and-estimating-means.html#cb119-2" tabindex="-1"></a><span class="do">## Loading required package: colorspace</span></span>
<span id="cb119-3"><a href="normal-and-estimating-means.html#cb119-3" tabindex="-1"></a><span class="do">## Loading required package: lme4</span></span>
<span id="cb119-4"><a href="normal-and-estimating-means.html#cb119-4" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb119-5"><a href="normal-and-estimating-means.html#cb119-5" tabindex="-1"></a><span class="do">## </span><span class="al">###</span><span class="do"> Mixture of methods including mixtures</span></span>
<span id="cb119-6"><a href="normal-and-estimating-means.html#cb119-6" tabindex="-1"></a><span class="do">## </span><span class="al">###</span><span class="do"> Arnost Komarek</span></span>
<span id="cb119-7"><a href="normal-and-estimating-means.html#cb119-7" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb119-8"><a href="normal-and-estimating-means.html#cb119-8" tabindex="-1"></a><span class="do">## </span><span class="al">###</span><span class="do"> See citation(&quot;mixAK&quot;) or toBibtex(citation(&quot;mixAK&quot;)) for the best way to cite</span></span>
<span id="cb119-9"><a href="normal-and-estimating-means.html#cb119-9" tabindex="-1"></a><span class="do">## </span><span class="al">###</span><span class="do"> the package if you find it useful.</span></span>
<span id="cb119-10"><a href="normal-and-estimating-means.html#cb119-10" tabindex="-1"></a></span>
<span id="cb119-11"><a href="normal-and-estimating-means.html#cb119-11" tabindex="-1"></a>mdl_mix <span class="ot">&lt;-</span> <span class="fu">NMixMCMC</span>(</span>
<span id="cb119-12"><a href="normal-and-estimating-means.html#cb119-12" tabindex="-1"></a>  <span class="at">y0 =</span> cinderella<span class="sc">$</span>x,</span>
<span id="cb119-13"><a href="normal-and-estimating-means.html#cb119-13" tabindex="-1"></a>  <span class="at">nMCMC =</span> <span class="fu">c</span>(<span class="at">burn =</span> <span class="dv">1000</span>, <span class="at">keep =</span> <span class="dv">1000</span>, <span class="at">thin =</span> <span class="dv">1</span>, <span class="at">info =</span> <span class="dv">100</span>),</span>
<span id="cb119-14"><a href="normal-and-estimating-means.html#cb119-14" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">list</span>(<span class="at">priorK =</span> <span class="st">&quot;fixed&quot;</span>, <span class="at">Kmax =</span> <span class="dv">3</span>)</span>
<span id="cb119-15"><a href="normal-and-estimating-means.html#cb119-15" tabindex="-1"></a>)</span>
<span id="cb119-16"><a href="normal-and-estimating-means.html#cb119-16" tabindex="-1"></a><span class="do">## Warning in ctmp * zVar2: Recycling array of length 1 in vector-array arithmetic is deprecated.</span></span>
<span id="cb119-17"><a href="normal-and-estimating-means.html#cb119-17" tabindex="-1"></a><span class="do">##   Use c() or as.vector() instead.</span></span>
<span id="cb119-18"><a href="normal-and-estimating-means.html#cb119-18" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb119-19"><a href="normal-and-estimating-means.html#cb119-19" tabindex="-1"></a><span class="do">## Chain number 1</span></span>
<span id="cb119-20"><a href="normal-and-estimating-means.html#cb119-20" tabindex="-1"></a><span class="do">## ==============</span></span>
<span id="cb119-21"><a href="normal-and-estimating-means.html#cb119-21" tabindex="-1"></a><span class="do">## MCMC sampling started on Thu Nov  2 08:01:31 2023.</span></span>
<span id="cb119-22"><a href="normal-and-estimating-means.html#cb119-22" tabindex="-1"></a><span class="do">## Burn-in iteration 1002003004005006007008009001000</span></span>
<span id="cb119-23"><a href="normal-and-estimating-means.html#cb119-23" tabindex="-1"></a><span class="do">## Iteration 1100120013001400150016001700180019002000</span></span>
<span id="cb119-24"><a href="normal-and-estimating-means.html#cb119-24" tabindex="-1"></a><span class="do">## MCMC sampling finished on Thu Nov  2 08:01:31 2023.</span></span>
<span id="cb119-25"><a href="normal-and-estimating-means.html#cb119-25" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb119-26"><a href="normal-and-estimating-means.html#cb119-26" tabindex="-1"></a><span class="do">## Chain number 2</span></span>
<span id="cb119-27"><a href="normal-and-estimating-means.html#cb119-27" tabindex="-1"></a><span class="do">## ==============</span></span>
<span id="cb119-28"><a href="normal-and-estimating-means.html#cb119-28" tabindex="-1"></a><span class="do">## MCMC sampling started on Thu Nov  2 08:01:31 2023.</span></span>
<span id="cb119-29"><a href="normal-and-estimating-means.html#cb119-29" tabindex="-1"></a><span class="do">## Burn-in iteration 1002003004005006007008009001000</span></span>
<span id="cb119-30"><a href="normal-and-estimating-means.html#cb119-30" tabindex="-1"></a><span class="do">## Iteration 1100120013001400150016001700180019002000</span></span>
<span id="cb119-31"><a href="normal-and-estimating-means.html#cb119-31" tabindex="-1"></a><span class="do">## MCMC sampling finished on Thu Nov  2 08:01:31 2023.</span></span>
<span id="cb119-32"><a href="normal-and-estimating-means.html#cb119-32" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb119-33"><a href="normal-and-estimating-means.html#cb119-33" tabindex="-1"></a><span class="do">## Computation of penalized expected deviance started on Thu Nov  2 08:01:31 2023.</span></span>
<span id="cb119-34"><a href="normal-and-estimating-means.html#cb119-34" tabindex="-1"></a><span class="do">## Computation of penalized expected deviance finished on Thu Nov  2 08:01:32 2023.</span></span>
<span id="cb119-35"><a href="normal-and-estimating-means.html#cb119-35" tabindex="-1"></a></span>
<span id="cb119-36"><a href="normal-and-estimating-means.html#cb119-36" tabindex="-1"></a><span class="co"># posterior means mu</span></span>
<span id="cb119-37"><a href="normal-and-estimating-means.html#cb119-37" tabindex="-1"></a><span class="fu">c</span>(mdl_mix[[<span class="dv">1</span>]]<span class="sc">$</span>poster.mean.mu <span class="sc">*</span> <span class="fu">sd</span>(cinderella<span class="sc">$</span>x)) <span class="sc">+</span> <span class="fu">mean</span>(cinderella<span class="sc">$</span>x)</span>
<span id="cb119-38"><a href="normal-and-estimating-means.html#cb119-38" tabindex="-1"></a><span class="do">## [1] 3.767875 4.914559 8.100875</span></span>
<span id="cb119-39"><a href="normal-and-estimating-means.html#cb119-39" tabindex="-1"></a></span>
<span id="cb119-40"><a href="normal-and-estimating-means.html#cb119-40" tabindex="-1"></a><span class="co"># posterior means for SD</span></span>
<span id="cb119-41"><a href="normal-and-estimating-means.html#cb119-41" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">c</span>(<span class="fu">unlist</span>(mdl_mix[[<span class="dv">1</span>]]<span class="sc">$</span>poster.mean.Sigma)))<span class="sc">*</span><span class="fu">sd</span>(cinderella<span class="sc">$</span>x)</span>
<span id="cb119-42"><a href="normal-and-estimating-means.html#cb119-42" tabindex="-1"></a><span class="do">##        j1        j2        j3 </span></span>
<span id="cb119-43"><a href="normal-and-estimating-means.html#cb119-43" tabindex="-1"></a><span class="do">## 0.2573165 0.6120158 0.9945381</span></span>
<span id="cb119-44"><a href="normal-and-estimating-means.html#cb119-44" tabindex="-1"></a></span>
<span id="cb119-45"><a href="normal-and-estimating-means.html#cb119-45" tabindex="-1"></a><span class="co"># estimated class frequency distribution</span></span>
<span id="cb119-46"><a href="normal-and-estimating-means.html#cb119-46" tabindex="-1"></a><span class="fu">round</span>(mdl_mix[[<span class="dv">1</span>]]<span class="sc">$</span>poster.mean.w, <span class="dv">2</span>)</span>
<span id="cb119-47"><a href="normal-and-estimating-means.html#cb119-47" tabindex="-1"></a><span class="do">##   w1   w2   w3 </span></span>
<span id="cb119-48"><a href="normal-and-estimating-means.html#cb119-48" tabindex="-1"></a><span class="do">## 0.31 0.20 0.49</span></span>
<span id="cb119-49"><a href="normal-and-estimating-means.html#cb119-49" tabindex="-1"></a></span>
<span id="cb119-50"><a href="normal-and-estimating-means.html#cb119-50" tabindex="-1"></a><span class="co"># estimated probability per class of first few seeds</span></span>
<span id="cb119-51"><a href="normal-and-estimating-means.html#cb119-51" tabindex="-1"></a>mdl_mix[[<span class="dv">1</span>]]<span class="sc">$</span>poster.comp.prob_u <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span>
<span id="cb119-52"><a href="normal-and-estimating-means.html#cb119-52" tabindex="-1"></a><span class="do">##       [,1]  [,2]  [,3]</span></span>
<span id="cb119-53"><a href="normal-and-estimating-means.html#cb119-53" tabindex="-1"></a><span class="do">## [1,] 0.951 0.049 0.000</span></span>
<span id="cb119-54"><a href="normal-and-estimating-means.html#cb119-54" tabindex="-1"></a><span class="do">## [2,] 0.697 0.303 0.000</span></span>
<span id="cb119-55"><a href="normal-and-estimating-means.html#cb119-55" tabindex="-1"></a><span class="do">## [3,] 0.932 0.068 0.000</span></span>
<span id="cb119-56"><a href="normal-and-estimating-means.html#cb119-56" tabindex="-1"></a><span class="do">## [4,] 0.916 0.084 0.000</span></span>
<span id="cb119-57"><a href="normal-and-estimating-means.html#cb119-57" tabindex="-1"></a><span class="do">## [5,] 0.477 0.522 0.001</span></span>
<span id="cb119-58"><a href="normal-and-estimating-means.html#cb119-58" tabindex="-1"></a><span class="do">## [6,] 0.921 0.079 0.000</span></span>
<span id="cb119-59"><a href="normal-and-estimating-means.html#cb119-59" tabindex="-1"></a></span>
<span id="cb119-60"><a href="normal-and-estimating-means.html#cb119-60" tabindex="-1"></a><span class="co"># Marginal plot</span></span>
<span id="cb119-61"><a href="normal-and-estimating-means.html#cb119-61" tabindex="-1"></a><span class="fu">NMixPredDensMarg</span>(mdl_mix[[<span class="dv">1</span>]], <span class="at">lgrid =</span> <span class="dv">150</span>) <span class="sc">%&gt;%</span> <span class="fu">plot</span>()</span></code></pre></div>
<p><img src="statistics_files/figure-html/unnamed-chunk-56-1.png" width="672" /></p>
<p>In this case we new how many classes were in the data. If that was unknown, you could use reversible-jump MCMC which produces a posterior distribution for the number of components.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="4">
<li id="fn4"><p>In Bayesian statistics, the normal distribution is parameterized with the inverse of variance, called the <em>precision</em>, <span class="math inline">\(\tau = 1 / \sigma^2\)</span>.<a href="normal-and-estimating-means.html#fnref4" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="gamma-poisson-and-estimating-counts.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="beta-binomial-and-estimating-proportions.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="assets/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toolbar": {
"position": "static"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
